<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bambu CRM v2 - MÃ³dulo Cuenta Corriente</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>

    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°
        MenÃº</button>

    <nav id="sidebar">
        <div class="logo">
            <span>â—†</span> Bambu CRM v2
        </div>

        <div class="nav-group">
            <div class="nav-header">DocumentaciÃ³n</div>
            <a href="index.html" class="nav-link">â† Volver al PRD</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">Ãndice</div>
            <a href="#contexto" class="nav-link">1. Contexto y Objetivo</a>
            <a href="#funcionalidad-principal" class="nav-link">2. Funcionalidad Principal</a>
            <a href="#vista-cuenta-corriente" class="nav-link">3. Vista Cuenta Corriente</a>
            <a href="#movimientos-automaticos" class="nav-link">4. Movimientos AutomÃ¡ticos</a>
            <a href="#pagos-manuales" class="nav-link">5. Pagos Manuales</a>
            <a href="#pagos-parciales" class="nav-link">6. Pagos Parciales</a>
            <a href="#pagos-genericos" class="nav-link">7. Pagos GenÃ©ricos</a>
            <a href="#ajustes-edicion-pedidos" class="nav-link">8. Ajustes por EdiciÃ³n</a>
            <a href="#integracion-ventas" class="nav-link">9. IntegraciÃ³n con Ventas</a>
            <a href="#casos-de-uso" class="nav-link">10. Casos de Uso</a>
            <a href="#flujos-usuario" class="nav-link">11. Flujos de Usuario</a>
        </div>
    </nav>

    <main>
        <header>
            <div
                style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase;">
                QuÃ­mica Bambu S.R.L.</div>
            <h1>Bambu CRM v2 <br><span style="font-weight: 300; font-size: 1.5rem; color: var(--text-secondary);">MÃ³dulo
                    Cuenta Corriente - EspecificaciÃ³n Completa</span></h1>

            <table>
                <tr>
                    <td style="width: 150px;"><strong>Fecha</strong></td>
                    <td>22 de Diciembre 2025</td>
                </tr>
                <tr>
                    <td><strong>Sistema</strong></td>
                    <td>Bambu CRM v2</td>
                </tr>
                <tr>
                    <td><strong>PropÃ³sito</strong></td>
                    <td>GestiÃ³n integral de saldos, pagos y historial por cliente</td>
                </tr>
            </table>
        </header>

        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>SituaciÃ³n</h3>
            <p>En la versiÃ³n 1 del sistema, la cuenta corriente era una funcionalidad bÃ¡sica sin integraciÃ³n completa
                con el mÃ³dulo de ventas y sin capacidad de registrar mÃ©todos de pago.</p>

            <h3>Problema identificado (audios con Carlos)</h3>
            <p><strong>Carlos necesita</strong>:</p>
            <ul>
                <li>Discriminar efectivo vs digital en todos los pagos</li>
                <li>Registrar pagos parciales (cliente paga menos del total)</li>
                <li>Registrar pagos genÃ©ricos (cliente transfiere sin especificar a quÃ© pedido corresponde)</li>
                <li>Tener historial completo de movimientos por cliente</li>
                <li>Usar cliente genÃ©rico "Venta FÃ¡brica" con cientos de transacciones</li>
            </ul>

            <p><strong>Cita textual</strong>:</p>
            <blockquote>
                "Me sirve especificar que de los 100.000 pesos, 80.000 fueron pagados en efectivo, y 20.000 por un medio
                digital. Porque eso me hace despuÃ©s sacarme la cuenta de cuÃ¡nto tengo que tener hecho en efectivo el
                Ãºltimo dÃ­a de la semana."
            </blockquote>
        </section>

        <section id="funcionalidad-principal">
            <h2>2. Funcionalidad Principal</h2>

            <h3>DescripciÃ³n</h3>
            <p>El mÃ³dulo Cuenta Corriente es el centro financiero de cada cliente, donde se registran:</p>
            <ul>
                <li>âœ… Cargos automÃ¡ticos (pedidos confirmados)</li>
                <li>âœ… Pagos manuales (totales, parciales, genÃ©ricos)</li>
                <li>âœ… DiscriminaciÃ³n efectivo/digital</li>
                <li>âœ… Historial completo de movimientos</li>
                <li>âœ… Saldo actual (debe o a favor)</li>
            </ul>

            <h3>CaracterÃ­sticas clave</h3>
            <ol>
                <li><strong>Todos los clientes tienen cuenta corriente</strong> (obligatorio)</li>
                <li><strong>Cargos automÃ¡ticos</strong> al confirmar pedidos</li>
                <li><strong>Pagos manuales</strong> registrados por operadores</li>
                <li><strong>DiscriminaciÃ³n mÃ©todo de pago</strong> (efectivo, digital, mixto)</li>
                <li><strong>Pagos parciales</strong> (monto < total pedido)</li>
                <li><strong>Pagos genÃ©ricos</strong> (no asociados a pedido especÃ­fico)</li>
                <li><strong>Historial cronolÃ³gico</strong> completo</li>
                <li><strong>Exportar Excel</strong> para contabilidad</li>
            </ol>
        </section>

        <section id="vista-cuenta-corriente">
            <h2>3. Vista Cuenta Corriente</h2>

            <h3>UbicaciÃ³n</h3>
            <p><strong>Ruta</strong>: Clientes â†’ Seleccionar cliente â†’ PestaÃ±a "Cuenta Corriente"</p>

            <h3>Panel superior: Resumen</h3>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cliente: Av. San MartÃ­n 1234                   â”‚
â”‚  TelÃ©fono: 299-1234567                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  Saldo actual: -$125.000 (debe)                â”‚
â”‚                                                 â”‚
â”‚  Total pedidos: 15                              â”‚
â”‚  Ãšltima compra: 20/12/2025                      â”‚
â”‚                                                 â”‚
â”‚  [+ Registrar pago genÃ©rico]  [Exportar Excel] â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Indicadores visuales saldo</strong>:</p>
            <ul>
                <li><strong>Negativo</strong> (debe): Texto rojo â†’ -$125.000</li>
                <li><strong>Cero</strong>: Texto gris â†’ $0</li>
                <li><strong>Positivo</strong> (a favor): Texto verde â†’ +$50.000</li>
            </ul>

            <h3>Tabla: Historial de movimientos</h3>
            <p><strong>Columnas</strong>:</p>
            <table>
                <tr>
                    <th>Fecha</th>
                    <th>Tipo</th>
                    <th>DescripciÃ³n</th>
                    <th>Cargo</th>
                    <th>Pago</th>
                    <th>MÃ©todo</th>
                    <th>Saldo</th>
                </tr>
                <tr>
                    <td>20/12</td>
                    <td>Cargo</td>
                    <td>Pedido #155</td>
                    <td>+$80.000</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-$80.000</td>
                </tr>
                <tr>
                    <td>20/12</td>
                    <td>Pago</td>
                    <td>Pago pedido #155</td>
                    <td>-</td>
                    <td>-$80.000</td>
                    <td>ğŸ’µ Efectivo</td>
                    <td>$0</td>
                </tr>
                <tr>
                    <td>18/12</td>
                    <td>Cargo</td>
                    <td>Pedido #148</td>
                    <td>+$45.000</td>
                    <td>-</td>
                    <td>-</td>
                    <td>-$45.000</td>
                </tr>
                <tr>
                    <td>18/12</td>
                    <td>Pago</td>
                    <td>Pago parcial #148</td>
                    <td>-</td>
                    <td>-$30.000</td>
                    <td>ğŸ’³ Digital</td>
                    <td>-$15.000</td>
                </tr>
                <tr>
                    <td>17/12</td>
                    <td>Pago</td>
                    <td>Pago genÃ©rico</td>
                    <td>-</td>
                    <td>-$15.000</td>
                    <td>ğŸ’µ Efectivo</td>
                    <td>$0</td>
                </tr>
            </table>

            <p><strong>Tipos de movimientos</strong>:</p>
            <ol>
                <li><strong>Cargo</strong>: Pedido confirmado (aumenta debe)</li>
                <li><strong>Pago</strong>: Pago registrado (reduce debe)</li>
            </ol>

            <p><strong>Iconos mÃ©todo de pago</strong>:</p>
            <ul>
                <li>ğŸ’µ Efectivo</li>
                <li>ğŸ’³ Digital (MercadoPago, transferencia)</li>
                <li>ğŸ’µğŸ’³ Mixto (efectivo + digital)</li>
            </ul>

            <p><strong>Ordenamiento</strong>: CronolÃ³gico descendente (mÃ¡s recientes primero)</p>

            <h3>Detalle movimiento (expandible)</h3>
            <p>Al hacer click en una fila, se expande mostrando:</p>

            <pre><code>ğŸ“¦ Cargo pedido #155 - 20/12/2025
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Monto total: $80.000
Estado pedido: Entregado
Tipo: Reparto
VehÃ­culo: CamiÃ³n A

Productos:
- Producto A x 5 â†’ $40.000
- Producto B x 2 â†’ $40.000

[Ver pedido completo]</code></pre>

            <pre><code>ğŸ’µ Pago pedido #155 - 20/12/2025
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Monto pagado: $80.000 (total)
MÃ©todo: Efectivo $80.000

Registrado por: Usuario Vendedor
Fecha registro: 20/12/2025 18:45

Nota: Cliente pagÃ³ al recibir</code></pre>
        </section>

        <section id="movimientos-automaticos">
            <h2>4. Movimientos AutomÃ¡ticos</h2>

            <h3>Cargo al confirmar pedido + Pago opcional (modo fÃ¡brica)</h3>
            <p><strong>CuÃ¡ndo</strong>: Usuario confirma pedido en cotizador</p>

            <p><strong>Flujo actualizado (con pago opcional en modo FÃBRICA)</strong>:</p>
            <pre><code>Cotizador â†’ Confirma pedido
                â†“
    Â¿Tiene cliente seleccionado?
                â†“
           [SÃ] â†’ Genera cargo automÃ¡tico en cuenta corriente
           [NO] â†’ No genera cargo (venta sin cliente)
                â†“
    <strong>Â¿Modo FÃBRICA + RegistrÃ³ pago?</strong>
                â†“
      [SÃ] â†’ Genera pago automÃ¡tico en cuenta corriente
           - Tipo: Pago
           - Monto: Monto recibido
           - MÃ©todo: Efectivo/Digital/Mixto
           - Saldo: Total - Monto recibido
      [NO] â†’ Solo cargo, sin pago
           - Saldo: Total (cliente debe)
                â†“
    Registro en historial:
    - Tipo: Cargo (siempre)
    - Tipo: Pago (si se registrÃ³ en cotizador)
    - DescripciÃ³n: Pedido #XXX / Pago pedido #XXX
    - Saldo: Actualizado segÃºn pagos</code></pre>

            <p><strong>Ejemplo 1 - Venta fÃ¡brica CON pago</strong>:</p>
            <ul>
                <li>Cliente: Av. San MartÃ­n 1234</li>
                <li>Saldo anterior: -$50.000</li>
                <li>Nuevo pedido: $80.000</li>
                <li><strong>Usuario registra pago en cotizador: $80.000 (efectivo)</strong></li>
                <li><strong>Resultado</strong>:
                    <ul>
                        <li>Cargo: +$80.000</li>
                        <li>Pago: -$80.000 (efectivo)</li>
                        <li>Saldo nuevo: -$50.000 (sin cambios, pago cubriÃ³ el pedido)</li>
                    </ul>
                </li>
            </ul>

            <p><strong>Ejemplo 2 - Venta fÃ¡brica CON pago parcial</strong>:</p>
            <ul>
                <li>Cliente: Av. Mitre 567</li>
                <li>Saldo anterior: $0</li>
                <li>Nuevo pedido: $100.000</li>
                <li><strong>Usuario registra pago parcial en cotizador: $30.000 (efectivo)</strong></li>
                <li><strong>Resultado</strong>:
                    <ul>
                        <li>Cargo: +$100.000</li>
                        <li>Pago: -$30.000 (efectivo)</li>
                        <li>Saldo nuevo: -$70.000 (pendiente)</li>
                    </ul>
                </li>
            </ul>

            <p><strong>Ejemplo 3 - Venta fÃ¡brica SIN pago (fiado)</strong>:</p>
            <ul>
                <li>Cliente: Calle Roca 890</li>
                <li>Saldo anterior: -$20.000</li>
                <li>Nuevo pedido: $50.000</li>
                <li><strong>Usuario NO registra pago en cotizador</strong></li>
                <li><strong>Resultado</strong>:
                    <ul>
                        <li>Cargo: +$50.000</li>
                        <li>Saldo nuevo: -$70.000 (debe)</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section id="pagos-manuales">
            <h2>5. Pagos Manuales</h2>

            <h3>Pago desde mÃ³dulo Ventas</h3>
            <p><strong>Contexto</strong>: Al marcar pedido como "Entregado", es OBLIGATORIO registrar mÃ©todo de pago</p>

            <p><strong>Flujo</strong>:</p>
            <pre><code>MÃ³dulo VENTAS â†’ Pedido en trÃ¡nsito â†’ [Marcar como entregado]
                                              â†“
                                Modal "Registrar pago"
                                              â†“
                        Â¿Pago total o parcial?
                                              â†“
                    [TOTAL]              [PARCIAL]
                       â†“                      â†“
            Ver secciÃ³n siguiente    Ver "Pagos parciales"</code></pre>

            <p><strong>Modal "Registrar pago" (pago total)</strong>:</p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Registrar pago - Pedido #155           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Total pedido: $80.000                  â”‚
â”‚                                         â”‚
â”‚  MÃ©todo de pago:                        â”‚
â”‚  â˜ Efectivo                             â”‚
â”‚  â˜ Digital (MercadoPago/Transferencia)  â”‚
â”‚                                         â”‚
â”‚  Nota (opcional):                       â”‚
â”‚  [____________________________________] â”‚
â”‚                                         â”‚
â”‚  [Cancelar]  [Guardar]                  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Si selecciona ambos (mixto)</strong>:</p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â˜‘ Efectivo                             â”‚
â”‚  Monto efectivo: [______] $50.000       â”‚
â”‚                                         â”‚
â”‚  â˜‘ Digital                              â”‚
â”‚  Monto digital:  [______] $30.000       â”‚
â”‚                                         â”‚
â”‚  Total: $80.000 âœ“                       â”‚
â”‚  (ValidaciÃ³n: suma debe igualar total)  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Efecto al guardar</strong>:</p>
            <ol>
                <li>Pedido cambia a estado "Entregado"</li>
                <li>Se registra pago en cuenta corriente del cliente</li>
                <li>Saldo cliente se reduce</li>
                <li>MÃ©todo de pago queda asociado al pedido</li>
            </ol>

            <h3>5.1 SincronizaciÃ³n bidireccional VENTAS â†” Cuenta Corriente â­ NUEVO (Dic 2025)</h3>

            <div class="note" style="border-left: 4px solid #28a745; background: #d4edda; padding: 1rem; margin: 1.5rem 0;">
                <p><strong>Sistema hÃ­brido de registro</strong>: Los pagos se pueden registrar desde <strong>AMBOS mÃ³dulos</strong> (VENTAS y Cuenta Corriente) con sincronizaciÃ³n automÃ¡tica para evitar duplicaciÃ³n.</p>
            </div>

            <h4>5.1.1 Flujo: Pago registrado desde VENTAS</h4>
            <p><strong>Caso de uso</strong>: Operador controlando repartos desde mÃ³dulo VENTAS</p>

            <pre><code>Usuario en VENTAS â†’ Marca pedido como "Entregado"
                    â†“
        Modal "Registrar entrega y pago"
        - Monto recibido
        - MÃ©todo: Efectivo/Digital/Mixto
        - Nota (opcional)
                    â†“
            Guarda pago desde VENTAS
                    â†“
    ğŸ”„ AUTOMÃTICO: Sistema crea movimiento en CC
                    â†“
    Registro en Cuenta Corriente:
    - Tipo: Pago
    - DescripciÃ³n: "Pago pedido #XXX"
    - Monto: $X
    - MÃ©todo: [Efectivo/Digital/Mixto]
    - Origen: VENTAS â† Campo adicional
    - Usuario: [Operador]
    - Timestamp: [Fecha/hora]</code></pre>

            <h4>5.1.2 Flujo: Pago registrado desde Cuenta Corriente</h4>
            <p><strong>Caso de uso</strong>: Cliente paga en fÃ¡brica o ajuste manual puntual</p>

            <pre><code>Usuario en CC â†’ [+ Registrar pago]
                    â†“
        Modal "Registrar Pago"
        Selecciona tipo:
        â—‹ Pago genÃ©rico
        â—‹ Pago a pedido especÃ­fico #XXX â† Esta opciÃ³n
                    â†“
        Guarda pago desde CC
                    â†“
    ğŸ”„ AUTOMÃTICO: Sistema actualiza pedido
                    â†“
    ActualizaciÃ³n en mÃ³dulo VENTAS:
    - pedido.monto_pagado += monto
    - Columna "Pagado" se actualiza
    - Badge visual cambia color si pagado completo</code></pre>

            <h4>5.1.3 Mecanismo anti-duplicados</h4>
            <p><strong>Problema a prevenir</strong>: Registrar el mismo pago dos veces (una vez desde VENTAS, otra desde CC)</p>

            <p><strong>SoluciÃ³n implementada</strong>:</p>
            <ol>
                <li><strong>ValidaciÃ³n pre-registro</strong>:
                    <ul>
                        <li>Antes de crear movimiento, sistema consulta: Â¿Ya existe pago para este pedido?</li>
                        <li>Query: <code>SELECT * FROM movimientos_cc WHERE pedido_id = X AND tipo = 'pago'</code></li>
                    </ul>
                </li>
                <li><strong>Campo origen</strong>:
                    <ul>
                        <li>Cada movimiento de pago registra su origen: "VENTAS" o "CC"</li>
                        <li>Permite auditorÃ­a y debugging</li>
                    </ul>
                </li>
                <li><strong>Bloqueo temporal</strong>:
                    <ul>
                        <li>Al registrar pago desde VENTAS â†’ Modal queda deshabilitado hasta que se confirme guardado en CC</li>
                        <li>Previene double-click accidental</li>
                    </ul>
                </li>
                <li><strong>Advertencia visual</strong>:
                    <ul>
                        <li>Si usuario intenta registrar pago desde CC para pedido que ya tiene pago completo desde VENTAS:</li>
                        <li>Sistema muestra: âš ï¸ "Este pedido ya tiene pago registrado el [fecha] desde VENTAS por [usuario]. Â¿Deseas agregar pago adicional?"</li>
                    </ul>
                </li>
            </ol>

            <h4>5.1.4 Trazabilidad completa</h4>
            <p><strong>Campos adicionales en tabla movimientos_cc</strong>:</p>
            <table>
                <tr>
                    <th>Campo</th>
                    <th>Tipo</th>
                    <th>DescripciÃ³n</th>
                </tr>
                <tr>
                    <td><code>origen</code></td>
                    <td>ENUM('VENTAS', 'CC', 'COTIZADOR')</td>
                    <td>MÃ³dulo desde donde se registrÃ³ el pago</td>
                </tr>
                <tr>
                    <td><code>usuario_id</code></td>
                    <td>INT</td>
                    <td>Usuario que registrÃ³ el movimiento</td>
                </tr>
                <tr>
                    <td><code>timestamp</code></td>
                    <td>DATETIME</td>
                    <td>Fecha/hora exacta del registro</td>
                </tr>
                <tr>
                    <td><code>pedido_id</code></td>
                    <td>INT (nullable)</td>
                    <td>NULL si es pago genÃ©rico, ID si es pago especÃ­fico</td>
                </tr>
            </table>

            <h4>5.1.5 Beneficios del sistema hÃ­brido</h4>
            <ul>
                <li>âœ… <strong>Flexibilidad</strong>: Operadores eligen dÃ³nde registrar segÃºn contexto de trabajo</li>
                <li>âœ… <strong>Eficiencia</strong>: Control masivo de repartos desde tabla VENTAS sin navegaciÃ³n extra</li>
                <li>âœ… <strong>PrecisiÃ³n</strong>: Casos puntuales se manejan desde perfil cliente en CC</li>
                <li>âœ… <strong>Consistencia</strong>: Ambos mÃ³dulos siempre muestran la misma informaciÃ³n actualizada</li>
                <li>âœ… <strong>AuditorÃ­a</strong>: Trazabilidad completa de quiÃ©n registrÃ³ quÃ©, cuÃ¡ndo y desde dÃ³nde</li>
            </ul>
        </section>

        <section id="pagos-parciales">
            <h2>6. Pagos Parciales</h2>

            <h3>DescripciÃ³n</h3>
            <p>Casos donde el cliente no paga el 100% del pedido al momento de la entrega.</p>

            <p><strong>Casos de uso</strong>:</p>
            <ul>
                <li>Cliente no tiene efectivo suficiente</li>
                <li>Cliente acuerda pagar resto despuÃ©s</li>
                <li>Error en el pedido (se devuelve producto)</li>
            </ul>

            <h3>Flujo pago parcial</h3>
            <p><strong>Modal "Registrar pago" (modo avanzado)</strong>:</p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Registrar pago - Pedido #155           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Total pedido: $100.000                 â”‚
â”‚                                         â”‚
â”‚  Monto recibido:                        â”‚
â”‚  [______] $80.000                       â”‚
â”‚                                         â”‚
â”‚  âš ï¸ Pago parcial detectado              â”‚
â”‚  Saldo pendiente: $20.000               â”‚
â”‚  (quedarÃ¡ en cuenta corriente)          â”‚
â”‚                                         â”‚
â”‚  MÃ©todo de pago:                        â”‚
â”‚  â˜‘ Efectivo  $80.000                    â”‚
â”‚  â˜ Digital                              â”‚
â”‚                                         â”‚
â”‚  Nota:                                  â”‚
â”‚  [Cliente pagarÃ¡ resto maÃ±ana_______]   â”‚
â”‚                                         â”‚
â”‚  [Cancelar]  [âœ“ Confirmar pago parcial] â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Efecto</strong>:</p>
            <ol>
                <li>Pedido: Estado "Entregado" (igual que pago total)</li>
                <li>Pago registrado: $80.000 efectivo</li>
                <li>Cuenta corriente: Saldo pendiente -$20.000</li>
            </ol>

            <p><strong>Registro en historial cuenta corriente</strong>:</p>
            <pre><code>20/12 | Cargo  | Pedido #155      | +$100.000 | -      | -         | -$100.000
20/12 | Pago   | Pago parcial #155| -         | -$80.000| ğŸ’µ Efectivo| -$20.000</code></pre>

            <p><strong>Vista en mÃ³dulo Ventas</strong>:</p>
            <pre><code>Tabla pedidos:
# 155 | 20/12 | Av. X | $100K | $80K | ğŸ’µ Efectivo | Entregado

Detalle pedido #155:
Total: $100.000
Pagado: $80.000 (efectivo)
Pendiente: $20.000 âš ï¸</code></pre>

            <h3>Completar pago pendiente</h3>
            <p><strong>Cuando el cliente paga el resto de un pedido con pago parcial</strong>:</p>
            <p>Ver <a href="#pagos-genericos" style="color: #0056b3; font-weight: 600;">â†’ SecciÃ³n 7: Registrar Pagos Manuales</a> - OpciÃ³n B: Pago a pedido especÃ­fico</p>

            <p><strong>Resumen rÃ¡pido</strong>:</p>
            <pre><code>Cuenta corriente cliente â†’ [+ Registrar pago]

Modal "Registrar pago":
  Monto: $20,000
  Aplicar a: â—‹ Pedido especÃ­fico â†’ Pedido #155
  MÃ©todo: â˜‘ Digital
  [Guardar]

Resultado:
- pedido.monto_pagado actualizado
- Saldo CC reducido
- Historial: "Pago pedido #155 -$20k (digital)"</code></pre>
        </section>

        <section id="pagos-genericos">
            <h2>7. Registrar Pagos Manuales (GenÃ©ricos o EspecÃ­ficos) â­ ACTUALIZADO</h2>

            <h3>DescripciÃ³n</h3>
            <p>El sistema permite registrar pagos manualmente desde la Cuenta Corriente del cliente con <strong>dos opciones</strong>:</p>
            <ol>
                <li><strong>Pago genÃ©rico</strong>: NO asociado a ningÃºn pedido especÃ­fico</li>
                <li><strong>Pago a pedido especÃ­fico</strong>: Asociado y actualiza el pedido seleccionado</li>
            </ol>

            <p><strong>Cita Carlos</strong>:</p>
            <blockquote>
                "Los pagos no siempre responden a cada pedido, sino que manda plata. O sea, al total de la cuenta que
                tengo, manda un poco de plata"
            </blockquote>

            <h3>7.1 Flujo: Registrar pago manual</h3>
            <p><strong>Desde cuenta corriente del cliente</strong>:</p>
            <pre><code>Cuenta corriente â†’ Panel superior â†’ [+ Registrar pago]</code></pre>

            <p><strong>Modal "Registrar pago" (ACTUALIZADO)</strong>:</p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Registrar pago                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Cliente: Av. San MartÃ­n 1234           â”‚
â”‚  Saldo actual: -$150.000 (debe)         â”‚
â”‚                                         â”‚
â”‚  Monto recibido:                        â”‚
â”‚  [______] $50.000                       â”‚
â”‚                                         â”‚
â”‚  MÃ©todo de pago:                        â”‚
â”‚  â˜‘ Efectivo  $50.000                    â”‚
â”‚  â˜ Digital                              â”‚
â”‚                                         â”‚
â”‚  Aplicar a:  â­ NUEVO                   â”‚
â”‚  â—‹ Pago genÃ©rico                        â”‚
â”‚     (reduce saldo total del cliente)    â”‚
â”‚                                         â”‚
â”‚  â—‹ Pedido especÃ­fico                    â”‚
â”‚     [Dropdown â–¼]                        â”‚
â”‚       â€¢ Pedido #100 (Pendiente $70k)    â”‚
â”‚       â€¢ Pedido #101 (Pendiente $50k)    â”‚
â”‚       â€¢ Pedido #155 (Pendiente $20k)    â”‚
â”‚                                         â”‚
â”‚  Fecha:                                 â”‚
â”‚  [20/12/2025]                           â”‚
â”‚                                         â”‚
â”‚  Nota (opcional):                       â”‚
â”‚  [________________________________]      â”‚
â”‚                                         â”‚
â”‚  Saldo despuÃ©s del pago: -$100.000      â”‚
â”‚                                         â”‚
â”‚  [Cancelar]  [Guardar]                  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>7.2 OpciÃ³n A: Pago genÃ©rico</h3>

            <p><strong>CuÃ¡ndo usar</strong>:</p>
            <ul>
                <li>Cliente transfiere sin especificar a quÃ© pedido corresponde</li>
                <li>Cliente paga adelanto general</li>
                <li>Cliente paga saldo acumulado sin detallar</li>
            </ul>

            <p><strong>Efecto</strong>:</p>
            <ol>
                <li>âœ… Reduce saldo total del cliente</li>
                <li>âœ… Queda registrado en historial CC</li>
                <li>âŒ NO actualiza ningÃºn pedido individual</li>
                <li>âŒ Columna "Pagado" en pedidos NO cambia</li>
            </ol>

            <p><strong>Ejemplo</strong>:</p>
            <pre><code>Cliente tiene:
- Pedido #100: Total $100k, Pagado $30k, Pendiente $70k
- Pedido #101: Total $50k,  Pagado $0,   Pendiente $50k
- Saldo CC: -$120k (debe)

Usuario registra: $80k digital â†’ OpciÃ³n: "Pago genÃ©rico"

Resultado:
- Saldo CC: -$40k (nuevo saldo)
- Pedido #100: SIN CAMBIOS (sigue mostrando Pagado $30k)
- Pedido #101: SIN CAMBIOS (sigue mostrando Pagado $0)
- Historial CC: "Pago genÃ©rico -$80k (digital)"</code></pre>

            <h3>7.3 OpciÃ³n B: Pago a pedido especÃ­fico â­ NUEVO</h3>

            <p><strong>CuÃ¡ndo usar</strong>:</p>
            <ul>
                <li>Cliente dice: "Esto es para completar el pedido #100"</li>
                <li>Cliente paga exactamente lo pendiente de un pedido</li>
                <li>Quieres cerrar un pedido especÃ­fico</li>
            </ul>

            <p><strong>Efecto</strong>:</p>
            <ol>
                <li>âœ… Reduce saldo total del cliente</li>
                <li>âœ… Queda registrado en historial CC</li>
                <li>âœ… Actualiza <code>pedido.monto_pagado</code></li>
                <li>âœ… Columna "Pagado" en VENTAS se actualiza</li>
            </ol>

            <p><strong>Validaciones</strong>:</p>
            <ul>
                <li>SI <code>monto = saldo_pendiente_pedido</code> â†’ Pedido queda saldado âœ…</li>
                <li>SI <code>monto < saldo_pendiente_pedido</code> â†’ Pago parcial adicional</li>
                <li>SI <code>monto > saldo_pendiente_pedido</code> â†’ âš ï¸ ERROR: "El monto excede lo pendiente. Use pago genÃ©rico."</li>
            </ul>

            <p><strong>Ejemplo 1 - Pago completo</strong>:</p>
            <pre><code>Pedido #100: Total $100k, Pagado $30k, Pendiente $70k

Usuario registra: $70k digital
â†’ OpciÃ³n: "Pedido especÃ­fico" â†’ Selecciona: Pedido #100

Resultado:
- pedido.monto_pagado = $30k + $70k = $100k âœ…
- Saldo CC: Reduce en $70k
- Historial CC: "Pago pedido #100 -$70k (digital)"
- En VENTAS: Pedido #100 muestra Pagado $100k âœ“ (verde)</code></pre>

            <p><strong>Ejemplo 2 - Pago parcial adicional</strong>:</p>
            <pre><code>Pedido #100: Total $100k, Pagado $30k, Pendiente $70k

Usuario registra: $40k digital
â†’ OpciÃ³n: "Pedido especÃ­fico" â†’ Selecciona: Pedido #100

Resultado:
- pedido.monto_pagado = $30k + $40k = $70k
- Saldo CC: Reduce en $40k
- Historial CC: "Pago adicional pedido #100 -$40k (digital)"
- En VENTAS: Pedido #100 muestra Pagado $70k âš ï¸ (naranja)
- Pendiente: $30k (aÃºn falta)</code></pre>

            <p><strong>Ejemplo 3 - Error: Monto excede pendiente</strong>:</p>
            <pre><code>Pedido #100: Pendiente $70k

Usuario intenta: $100k â†’ OpciÃ³n: "Pedido especÃ­fico"

Sistema muestra ERROR:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ Error: Monto excede lo pendiente     â”‚
â”‚                                         â”‚
â”‚ Monto ingresado: $100,000               â”‚
â”‚ Pendiente pedido #100: $70,000          â”‚
â”‚ Excedente: $30,000                      â”‚
â”‚                                         â”‚
â”‚ Sugerencia:                             â”‚
â”‚ 1. Use pago GENÃ‰RICO si el cliente      â”‚
â”‚    transfiriÃ³ de mÃ¡s                    â”‚
â”‚ 2. O ingrese exactamente $70,000        â”‚
â”‚                                         â”‚
â”‚ [Aceptar]                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>7.4 Tabla comparativa: GenÃ©rico vs EspecÃ­fico</h3>
            <table>
                <tr>
                    <th>CaracterÃ­stica</th>
                    <th>Pago genÃ©rico</th>
                    <th>Pago a pedido especÃ­fico</th>
                </tr>
                <tr>
                    <td><strong>AsociaciÃ³n</strong></td>
                    <td>Ninguna</td>
                    <td>Pedido especÃ­fico (#100)</td>
                </tr>
                <tr>
                    <td><strong>Actualiza pedido</strong></td>
                    <td>âŒ NO</td>
                    <td>âœ… SÃ (monto_pagado)</td>
                </tr>
                <tr>
                    <td><strong>Aparece en VENTAS</strong></td>
                    <td>âŒ NO (solo en CC)</td>
                    <td>âœ… SÃ (columna "Pagado")</td>
                </tr>
                <tr>
                    <td><strong>ValidaciÃ³n monto</strong></td>
                    <td>Cualquier monto</td>
                    <td>â‰¤ Pendiente del pedido</td>
                </tr>
                <tr>
                    <td><strong>DescripciÃ³n historial</strong></td>
                    <td>"Pago genÃ©rico"</td>
                    <td>"Pago pedido #100"</td>
                </tr>
                <tr>
                    <td><strong>Uso comÃºn</strong></td>
                    <td>Cliente transfiere sin especificar</td>
                    <td>Cliente paga pedido especÃ­fico</td>
                </tr>
                <tr>
                    <td><strong>Reduce saldo CC</strong></td>
                    <td>âœ… SÃ</td>
                    <td>âœ… SÃ</td>
                </tr>
            </table>

            <h3>7.5 Caso de uso completo</h3>
            <pre><code>Estado inicial:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cliente: Av. San MartÃ­n 1234                        â”‚
â”‚ Saldo CC: -$120,000 (debe)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Pedidos:                                            â”‚
â”‚ â€¢ #100: Total $100k | Pagado $30k | Pend. $70k      â”‚
â”‚ â€¢ #101: Total $50k  | Pagado $0   | Pend. $50k      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DÃ­a 1: Cliente transfiere $50k sin especificar
Usuario registra: $50k digital â†’ "Pago genÃ©rico"

Resultado:
- Saldo CC: -$70k
- Pedido #100: Pagado $30k (sin cambios)
- Pedido #101: Pagado $0 (sin cambios)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DÃ­a 3: Cliente paga especÃ­ficamente el pedido #101
Usuario registra: $50k efectivo â†’ "Pedido #101"

Resultado:
- Saldo CC: -$20k
- Pedido #100: Pagado $30k (sin cambios)
- Pedido #101: Pagado $50k âœ“ (saldado)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

DÃ­a 5: Cliente completa el pedido #100
Usuario registra: $20k digital â†’ "Pedido #100"

Resultado:
- Saldo CC: $0 âœ…
- Pedido #100: Pagado $50k âš ï¸ (sigue pendiente $50k)
- Pedido #101: Pagado $50k âœ“

NOTA: Pedido #100 muestra pendiente $50k aunque el
cliente no deba nada (saldo $0) porque esos $50k
fueron un pago genÃ©rico del DÃ­a 1.</code></pre>

            <h3>7.6 Registro en historial cuenta corriente</h3>
            <p><strong>Pago genÃ©rico</strong>:</p>
            <pre><code>20/12 | Pago | Pago genÃ©rico | - | -$50.000 | ğŸ’µ Efectivo | -$100.000</code></pre>

            <p><strong>Pago a pedido especÃ­fico</strong>:</p>
            <pre><code>20/12 | Pago | Pago pedido #100 | - | -$70.000 | ğŸ’³ Digital | -$30.000
                                  â””â”€ Referencia al pedido</code></pre>
        </section>

        <section id="ajustes-edicion-pedidos">
            <h2>8. Ajustes por EdiciÃ³n de Pedidos</h2>

            <h3>DescripciÃ³n</h3>
            <p><strong>Problema</strong>: Cuando se edita un pedido post-entrega (ajustar cantidades, cambiar productos), el total del pedido cambia y se debe reflejar en cuenta corriente.</p>

            <p><strong>SoluciÃ³n</strong>: Sistema genera AJUSTE automÃ¡tico sin modificar el cargo original (trazabilidad).</p>

            <h3>Regla crÃ­tica</h3>
            <blockquote>
                El cargo original del pedido NUNCA se modifica. Siempre se crea un NUEVO movimiento tipo "Ajuste" con la diferencia.
            </blockquote>

            <h3>Flujo de ajuste</h3>
            <pre><code>MÃ³dulo VENTAS â†’ Editar pedido entregado
                    â†“
    Modificar cantidades/productos
    Total anterior: $10.000
    Total nuevo: $9.000
    Diferencia: -$1.000
                    â†“
    Sistema AUTOMÃTICO:
    - NO modifica cargo original
    - Crea movimiento tipo "Ajuste"
    - Monto: -$1.000 (crÃ©dito a favor)
    - Referencia: pedido_id #1234
    - Flag: pedido_editado = true
                    â†“
    Cuenta corriente actualizada</code></pre>

            <h3>Datos del ajuste</h3>
            <table>
                <tr>
                    <th>Campo</th>
                    <th>DescripciÃ³n</th>
                    <th>Ejemplo</th>
                </tr>
                <tr>
                    <td><strong>Tipo movimiento</strong></td>
                    <td>Ajuste por ediciÃ³n de pedido</td>
                    <td>"Ajuste pedido #1234"</td>
                </tr>
                <tr>
                    <td><strong>Monto</strong></td>
                    <td>Diferencia (nuevo total - total original)</td>
                    <td>-$1.000 (si se redujo el pedido)</td>
                </tr>
                <tr>
                    <td><strong>Referencia</strong></td>
                    <td>ID del pedido editado</td>
                    <td>pedido_id: 1234</td>
                </tr>
                <tr>
                    <td><strong>Flag especial</strong></td>
                    <td>Marca para identificar ajustes</td>
                    <td>pedido_editado: true</td>
                </tr>
                <tr>
                    <td><strong>Usuario</strong></td>
                    <td>Quien realizÃ³ la ediciÃ³n</td>
                    <td>user_id: 5 (Juan PÃ©rez)</td>
                </tr>
                <tr>
                    <td><strong>Timestamp</strong></td>
                    <td>Fecha/hora exacta</td>
                    <td>2025-12-22 14:30:45</td>
                </tr>
                <tr>
                    <td><strong>Nota</strong></td>
                    <td>RazÃ³n del ajuste (opcional)</td>
                    <td>"Cliente devolviÃ³ 1 unidad"</td>
                </tr>
            </table>

            <h3>Ejemplo completo</h3>
            <p><strong>SituaciÃ³n</strong>:</p>
            <ul>
                <li>Pedido original: $10.000 (10 unidades)</li>
                <li>EdiciÃ³n: Cliente devolviÃ³ 1 unidad</li>
                <li>Nuevo total: $9.000 (9 unidades)</li>
            </ul>

            <p><strong>Historial cuenta corriente ANTES de ediciÃ³n</strong>:</p>
            <pre><code>Fecha       | Tipo         | Debe    | Haber | Saldo
2025-12-20  | Pedido #1234 | $10.000 | -     | -$10.000</code></pre>

            <p><strong>Historial cuenta corriente DESPUÃ‰S de ediciÃ³n</strong>:</p>
            <pre><code>Fecha       | Tipo              | Debe    | Haber   | Saldo
2025-12-20  | Pedido #1234      | $10.000 | -       | -$10.000
2025-12-22  | Ajuste pedido #1234| -      | $1.000  | -$9.000
            (Cliente devolviÃ³ 1 unidad)</code></pre>

            <p><strong>Resultado</strong>:</p>
            <ul>
                <li>âœ… Cargo original intacto (auditorÃ­a)</li>
                <li>âœ… Ajuste visible separado (trazabilidad)</li>
                <li>âœ… Saldo final correcto: -$9.000</li>
            </ul>

            <h3>Validaciones del sistema</h3>
            <ol>
                <li>Si el pedido NO tiene cliente â†’ NO genera ajuste en CC</li>
                <li>Si el total NO cambiÃ³ â†’ NO genera ajuste (solo actualiza productos/cantidades)</li>
                <li>Si el cambio es positivo â†’ Genera ajuste de CARGO (+)</li>
                <li>Si el cambio es negativo â†’ Genera ajuste de CRÃ‰DITO (-)</li>
            </ol>

            <h3>Caso: Ajuste positivo</h3>
            <p><strong>SituaciÃ³n</strong>: Cliente comprÃ³ 2 productos adicionales de Ãºltimo momento</p>
            <pre><code>Pedido original: $10.000
EdiciÃ³n: +2 productos
Nuevo total: $12.000
Diferencia: +$2.000

Historial:
2025-12-20  | Pedido #1234       | $10.000 | -      | -$10.000
2025-12-22  | Ajuste pedido #1234| $2.000  | -      | -$12.000
            (Cliente agregÃ³ 2 productos)</code></pre>
        </section>

        <section id="integracion-ventas">
            <h2>9. IntegraciÃ³n con Ventas</h2>

            <h3>RelaciÃ³n bidireccional</h3>

            <p><strong>1. Ventas â†’ Cuenta Corriente</strong></p>
            <pre><code>MÃ³dulo VENTAS:
  Marcar pedido como "Entregado"
        â†“
  Registrar mÃ©todo de pago
        â†“
  AUTOMÃTICO: Crea movimiento en cuenta corriente
  - Tipo: Pago
  - DescripciÃ³n: Pago pedido #XXX
  - Monto: SegÃºn registrado
  - MÃ©todo: Efectivo/Digital/Mixto</code></pre>

            <p><strong>2. Cuenta Corriente â†’ Ventas</strong></p>
            <pre><code>Cuenta Corriente:
  Historial movimiento "Cargo pedido #155"
        â†“
  Click en [Ver pedido completo]
        â†“
  Abre detalle pedido en mÃ³dulo VENTAS</code></pre>

            <h3>Columna "Pagado" en mÃ³dulo Ventas</h3>
            <p><strong>Tabla pedidos (mÃ³dulo Ventas)</strong>:</p>
            <table>
                <tr>
                    <th>#</th>
                    <th>Fecha</th>
                    <th>DirecciÃ³n</th>
                    <th>Total</th>
                    <th><strong>Pagado</strong></th>
                    <th>MÃ©todo</th>
                    <th>Estado</th>
                </tr>
                <tr>
                    <td>155</td>
                    <td>20/12</td>
                    <td>Av. X</td>
                    <td>$100K</td>
                    <td><strong>$100K âœ“</strong></td>
                    <td>ğŸ’µ</td>
                    <td>Entregado</td>
                </tr>
                <tr>
                    <td>148</td>
                    <td>18/12</td>
                    <td>Calle Y</td>
                    <td>$80K</td>
                    <td><strong>$60K âš ï¸</strong></td>
                    <td>ğŸ’µğŸ’³</td>
                    <td>Entregado</td>
                </tr>
                <tr>
                    <td>140</td>
                    <td>15/12</td>
                    <td>Av. Z</td>
                    <td>$50K</td>
                    <td><strong>$0 âš ï¸</strong></td>
                    <td>-</td>
                    <td>En trÃ¡nsito</td>
                </tr>
            </table>

            <p><strong>Indicadores visuales</strong>:</p>
            <ul>
                <li>âœ“ Verde: Pago completo (pagado = total)</li>
                <li>âš ï¸ Naranja: Pago parcial (pagado < total)</li>
                <li>âš ï¸ Rojo: Sin registrar (pagado = 0)</li>
            </ul>
        </section>

        <section id="casos-de-uso">
            <h2>10. Casos de Uso</h2>

            <h3>Caso 1: Venta de reparto tÃ­pica (98% casos)</h3>
            <p><strong>Escenario</strong>: Cliente compra $80.000, paga completo en efectivo</p>
            <pre><code>1. Cotizador â†’ Confirma pedido
   â†’ Cargo: +$80.000 en cuenta corriente

2. MÃ³dulo Ventas â†’ Marca "Entregado"
   â†’ Registra pago: $80.000 efectivo
   â†’ Pago: -$80.000 en cuenta corriente
   â†’ Saldo: $0</code></pre>

            <p><strong>Historial</strong>:</p>
            <pre><code>20/12 | Cargo | Pedido #155 | +$80.000 | - | - | -$80.000
20/12 | Pago  | Pago #155   | - | -$80.000 | ğŸ’µ | $0</code></pre>

            <h3>Caso 2: Cliente genÃ©rico "Venta FÃ¡brica"</h3>
            <p><strong>Escenario</strong>: 8 ventas diarias sin cliente especÃ­fico</p>
            <pre><code>Cliente creado: "Venta FÃ¡brica"

Venta 1 (10:00):
- Cargo: +$30.000
- Pago: -$30.000 digital
- Saldo: $0

Venta 2 (11:30):
- Cargo: +$15.000
- Pago: -$15.000 efectivo
- Saldo: $0

... (6 ventas mÃ¡s en el dÃ­a)</code></pre>

            <p><strong>Historial cuenta corriente "Venta FÃ¡brica"</strong>:</p>
            <pre><code>Cientos de movimientos diarios
Siempre saldo $0 (todo se paga al momento)
Ãštil para estadÃ­sticas efectivo/digital</code></pre>

            <h3>Caso 3: Cliente con cuenta corriente real</h3>
            <p><strong>Escenario</strong>: Cliente compra seguido, paga cada semana</p>
            <pre><code>Lunes:
- Pedido #140: +$50.000 â†’ Saldo: -$50.000

MiÃ©rcoles:
- Pedido #145: +$40.000 â†’ Saldo: -$90.000

Viernes:
- Pedido #150: +$60.000 â†’ Saldo: -$150.000
- Pago genÃ©rico: -$150.000 digital â†’ Saldo: $0</code></pre>

            <p><strong>Historial</strong>:</p>
            <pre><code>15/12 | Cargo | Pedido #140 | +$50K | - | - | -$50K
17/12 | Cargo | Pedido #145 | +$40K | - | - | -$90K
19/12 | Cargo | Pedido #150 | +$60K | - | - | -$150K
19/12 | Pago  | Pago genÃ©rico | - | -$150K | ğŸ’³ | $0</code></pre>

            <h3>Caso 4: Pago parcial con complemento posterior</h3>
            <p><strong>Escenario</strong>: Cliente paga $80K de $100K, resto al dÃ­a siguiente</p>
            <pre><code>DÃ­a 1 (entrega):
- Pedido #155: +$100.000
- Pago parcial: -$80.000 efectivo
- Saldo: -$20.000

DÃ­a 2 (complemento):
- Pago complemento: -$20.000 digital
- Saldo: $0</code></pre>

            <p><strong>Historial</strong>:</p>
            <pre><code>20/12 | Cargo | Pedido #155 | +$100K | - | - | -$100K
20/12 | Pago | Pago parcial #155 | - | -$80K | ğŸ’µ | -$20K
21/12 | Pago | Complemento #155 | - | -$20K | ğŸ’³ | $0</code></pre>
        </section>

        <section id="flujos-usuario">
            <h2>11. Flujos de Usuario</h2>

            <h3>Flujo 1: Consultar saldo de un cliente</h3>
            <ol>
                <li>Usuario abre "Clientes"</li>
                <li>Busca cliente por direcciÃ³n</li>
                <li>Click en cliente</li>
                <li>Abre pestaÃ±a "Cuenta Corriente"</li>
                <li>Ve saldo actual en panel superior</li>
                <li>Ve historial completo de movimientos</li>
            </ol>

            <h3>Flujo 2: Registrar pago genÃ©rico</h3>
            <ol>
                <li>Usuario abre cuenta corriente del cliente</li>
                <li>Click "Registrar pago genÃ©rico"</li>
                <li>Ingresa monto recibido</li>
                <li>Selecciona mÃ©todo: Efectivo | Digital | Ambos</li>
                <li>(Opcional) Agrega nota</li>
                <li>Guarda</li>
                <li>Sistema:
                    <ul>
                        <li>Reduce saldo cliente</li>
                        <li>Registra en historial</li>
                        <li>Actualiza totales efectivo/digital</li>
                    </ul>
                </li>
            </ol>

            <h3>Flujo 3: Completar pago pendiente</h3>
            <ol>
                <li>Usuario revisa cuenta corriente cliente</li>
                <li>Ve pedido con saldo pendiente (ej: -$20.000)</li>
                <li>Click en el cargo del pedido</li>
                <li>Click "Registrar pago adicional"</li>
                <li>Confirma monto pendiente o modifica</li>
                <li>Selecciona mÃ©todo de pago</li>
                <li>Guarda</li>
                <li>Saldo del pedido queda en $0</li>
            </ol>

            <h3>Flujo 4: Exportar historial para contabilidad</h3>
            <ol>
                <li>Usuario abre cuenta corriente del cliente</li>
                <li>(Opcional) Filtra por perÃ­odo</li>
                <li>Click "Exportar Excel"</li>
                <li>Descarga archivo con:
                    <ul>
                        <li>Fecha | Tipo | DescripciÃ³n | Cargo | Pago | MÃ©todo | Saldo</li>
                    </ul>
                </li>
                <li>EnvÃ­a a contador</li>
            </ol>
        </section>

        <section id="nota-importante">
            <div class="note" style="border-left: 4px solid #28a745; background: #d4edda;">
                <h3>âœ… DOCUMENTO ACTUALIZADO - VERSIÃ“N MEJORADA</h3>
                <p><strong>Mejoras incorporadas (27/12/2025):</strong></p>
                <ul>
                    <li>âœ… <strong>SecciÃ³n 7 rediseÃ±ada</strong>: Sistema hÃ­brido de pagos (GenÃ©ricos + EspecÃ­ficos)</li>
                    <li>âœ… <strong>Modal "Registrar pago" actualizado</strong>: Dropdown para seleccionar pedido especÃ­fico</li>
                    <li>âœ… <strong>Validaciones completas</strong>: Monto no puede exceder pendiente del pedido</li>
                    <li>âœ… <strong>Tabla comparativa</strong>: 7 diferencias entre pago genÃ©rico vs especÃ­fico</li>
                    <li>âœ… <strong>Ejemplos exhaustivos</strong>: Pago completo, parcial adicional, error excede monto</li>
                    <li>âœ… <strong>Caso de uso completo</strong>: 3 dÃ­as, combinando pagos genÃ©ricos y especÃ­ficos</li>
                    <li>âœ… <strong>SecciÃ³n 8: Ajustes por EdiciÃ³n de Pedidos</strong>: Mecanismo completo</li>
                    <li>âœ… <strong>Trazabilidad total</strong>: Usuario, timestamp, flag pedido_editado</li>
                </ul>
                <p><strong>Estado del documento</strong>: EspecificaciÃ³n funcional tÃ©cnica COMPLETA con sistema de pagos hÃ­brido.</p>
            </div>

            <div class="note" style="border-left: 4px solid #ffc107; background: #fff3cd;">
                <h3>âš ï¸ NOTA IMPORTANTE: PROTOTIPADO REQUERIDO</h3>
                <p><strong>El mÃ³dulo CUENTA CORRIENTE es crÃ­tico para la operaciÃ³n financiera del sistema.</strong></p>
                <p>Dado su alto nivel de complejidad e importancia, se requiere:</p>
                <ul>
                    <li>âœ… <strong>Prototipado de wireframes/mockups</strong> para definir:
                        <ul>
                            <li>DiseÃ±o visual de la interfaz</li>
                            <li>Tabla historial de movimientos optimizada</li>
                            <li>Modales de registro de pagos (genÃ©ricos, parciales)</li>
                            <li>Indicadores visuales (saldos, mÃ©todos de pago)</li>
                            <li>IntegraciÃ³n con mÃ³dulo Ventas</li>
                        </ul>
                    </li>
                    <li>ğŸ“ <strong>Estado actual</strong>: EspecificaciÃ³n funcional completa en texto</li>
                    <li>ğŸ¨ <strong>Pendiente</strong>:
                        <ul>
                            <li>DiseÃ±o UI/UX detallado</li>
                            <li>Wireframes interactivos</li>
                            <li>ValidaciÃ³n con cliente antes de desarrollo</li>
                        </ul>
                    </li>
                </ul>
                <p><strong>Este documento define QUÃ‰ hace el mÃ³dulo. Los wireframes definirÃ¡n CÃ“MO se ve y CÃ“MO se
                        usa.</strong></p>
            </div>
        </section>

        <section id="resumen-funcional">
            <h2>11. Resumen Funcional</h2>

            <h3>Funcionalidades clave:</h3>
            <ol>
                <li>âœ… <strong>Cuenta corriente para todos los clientes</strong> (obligatorio)</li>
                <li>âœ… <strong>Cargos automÃ¡ticos</strong> al confirmar pedidos</li>
                <li>âœ… <strong>Pagos totales</strong> (100% del pedido)</li>
                <li>âœ… <strong>Pagos parciales</strong> (< 100%, saldo queda pendiente)</li>
                <li>âœ… <strong>Pagos genÃ©ricos</strong> (no asociados a pedido)</li>
                <li>âœ… <strong>DiscriminaciÃ³n efectivo/digital/mixto</strong> en todos los pagos</li>
                <li>âœ… <strong>Historial cronolÃ³gico</strong> completo</li>
                <li>âœ… <strong>Saldo actualizado</strong> en tiempo real</li>
                <li>âœ… <strong>IntegraciÃ³n bidireccional</strong> con mÃ³dulo Ventas</li>
                <li>âœ… <strong>Exportar Excel</strong> para contabilidad</li>
            </ol>

            <h3>IntegraciÃ³n con otros mÃ³dulos:</h3>
            <table>
                <tr>
                    <th>MÃ³dulo</th>
                    <th>RelaciÃ³n</th>
                </tr>
                <tr>
                    <td><strong>Cotizador</strong></td>
                    <td>Genera cargos automÃ¡ticos al confirmar + Genera pagos (si se registrÃ³ en modo fÃ¡brica)</td>
                </tr>
                <tr>
                    <td><strong>Ventas</strong></td>
                    <td>Registra pagos al marcar "Entregado"</td>
                </tr>
                <tr>
                    <td><strong>Clientes</strong></td>
                    <td>Cada cliente tiene su cuenta corriente</td>
                </tr>
                <tr>
                    <td><strong>EstadÃ­sticas</strong></td>
                    <td>EstadÃ­sticas efectivo vs digital</td>
                </tr>
            </table>
        </section>

    </main>

</body>

</html>