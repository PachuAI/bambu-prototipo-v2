<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - Cuenta Corriente | Bambu CRM V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>
    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞ Men√∫</button>

    <nav id="sidebar">
        <div class="logo"><span>‚óÜ</span> Bambu CRM v2</div>
        <div class="nav-group">
            <div class="nav-header">Navegaci√≥n</div>
            <a href="index.html" class="nav-link">‚Üê PRD General</a>
        </div>
        <div class="nav-group">
            <div class="nav-header">En esta p√°gina</div>
            <a href="#contexto" class="nav-link">1. Contexto</a>
            <a href="#funcionalidad" class="nav-link">2. Funcionalidad</a>
            <a href="#vista" class="nav-link">3. Vista</a>
            <a href="#movimientos" class="nav-link">4. Tipos de Movimiento</a>
            <a href="#pagos" class="nav-link">5. Sistema de Pagos</a>
            <a href="#ajustes" class="nav-link">6. Ajustes</a>
            <a href="#integracion" class="nav-link">7. Integraci√≥n</a>
        </div>
    </nav>

    <main>
        <header>
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary);">Qu√≠mica Bambu S.R.L.</div>
            <h1>PRD: M√≥dulo Cuenta Corriente</h1>
            <table>
                <tr><td><strong>Versi√≥n</strong></td><td>2.0 (Limpio - Enero 2026)</td></tr>
                <tr><td><strong>Prototipo</strong></td><td><a href="../prototipos/cliente-detalle.html">prototipos/cliente-detalle.html</a> (Tab CC)</td></tr>
                <tr><td><strong>Estado</strong></td><td>Prototipo validado</td></tr>
            </table>
            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <strong>Nota:</strong> Este PRD describe funcionalidades y reglas de negocio. Para referencia visual, ver el prototipo HTML.
            </div>
        </header>

        <!-- CONTEXTO -->
        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>1.1 Descripci√≥n</h3>
            <p>Centro financiero de cada cliente. Registra cargos, pagos y saldo actual.</p>

            <h3>1.2 Necesidades del negocio</h3>
            <ul>
                <li>Discriminar efectivo vs digital en todos los pagos</li>
                <li>Registrar pagos parciales (cliente paga menos del total)</li>
                <li>Registrar pagos gen√©ricos (sin asociar a pedido espec√≠fico)</li>
                <li>Historial completo de movimientos por cliente</li>
                <li>Exportar para contabilidad</li>
            </ul>

            <h3>1.3 Ubicaci√≥n</h3>
            <p><strong>Ruta:</strong> Clientes ‚Üí Seleccionar cliente ‚Üí Pesta√±a "Cuenta Corriente"</p>
        </section>

        <!-- FUNCIONALIDAD -->
        <section id="funcionalidad">
            <h2>2. Funcionalidad Principal</h2>

            <h3>2.1 Caracter√≠sticas</h3>
            <ul>
                <li>Todos los clientes tienen cuenta corriente (obligatorio)</li>
                <li>Cargos autom√°ticos al confirmar pedidos</li>
                <li>Pagos manuales registrados por operadores</li>
                <li>Discriminaci√≥n m√©todo de pago (efectivo, digital, mixto)</li>
                <li>Pagos parciales permitidos</li>
                <li>Pagos gen√©ricos (no asociados a pedido)</li>
                <li>Historial cronol√≥gico completo</li>
            </ul>

            <h3>2.2 C√°lculo de saldo</h3>
            <p><strong>F√≥rmula:</strong> Saldo = Suma de cargos - Suma de pagos</p>
            <table>
                <tr><th>Saldo</th><th>Significado</th><th>Color</th></tr>
                <tr><td>Negativo (-$50.000)</td><td>Cliente DEBE dinero</td><td>Rojo</td></tr>
                <tr><td>Cero ($0)</td><td>Al d√≠a</td><td>Gris</td></tr>
                <tr><td>Positivo (+$10.000)</td><td>Cliente tiene SALDO A FAVOR</td><td>Verde</td></tr>
            </table>
        </section>

        <!-- VISTA -->
        <section id="vista">
            <h2>3. Vista Cuenta Corriente</h2>

            <h3>3.1 Panel superior (Resumen)</h3>
            <ul>
                <li>Saldo actual (con color seg√∫n estado)</li>
                <li>Total de pedidos</li>
                <li>Fecha √∫ltima compra</li>
                <li>Botones: [+ Registrar pago] [Exportar Excel]</li>
            </ul>

            <h3>3.2 Tabla de movimientos</h3>
            <p><strong>Columnas:</strong></p>
            <ul>
                <li>Fecha</li>
                <li>Tipo (Cargo / Pago / Ajuste)</li>
                <li>Descripci√≥n (ej: "Pedido #155", "Pago gen√©rico")</li>
                <li>Cargo (+$)</li>
                <li>Pago (-$)</li>
                <li>M√©todo (efectivo/digital/mixto)</li>
                <li>Saldo resultante</li>
            </ul>
            <p><strong>Ordenamiento:</strong> Cronol√≥gico descendente (m√°s recientes primero)</p>

            <h3>3.3 Detalle expandible</h3>
            <p>Al hacer click en fila, muestra informaci√≥n adicional:</p>
            <ul>
                <li>Para cargos: productos del pedido, estado, veh√≠culo</li>
                <li>Para pagos: usuario que registr√≥, fecha/hora, notas</li>
                <li>Para ajustes: raz√≥n del ajuste, pedido relacionado</li>
            </ul>
        </section>

        <!-- MOVIMIENTOS -->
        <section id="movimientos">
            <h2>4. Tipos de Movimiento</h2>

            <h3>4.1 Cargo</h3>
            <p><strong>Origen:</strong> Autom√°tico al confirmar pedido con cliente</p>
            <ul>
                <li>Aumenta el saldo deudor del cliente</li>
                <li>Se genera al confirmar desde Cotizador (no en borrador)</li>
                <li>Contiene referencia al pedido</li>
            </ul>

            <h3>4.2 Pago</h3>
            <p><strong>Origen:</strong> Manual desde VENTAS o Cuenta Corriente</p>
            <ul>
                <li>Reduce el saldo deudor del cliente</li>
                <li>Requiere m√©todo de pago (efectivo/digital/mixto)</li>
                <li>Puede ser asociado a pedido o gen√©rico</li>
            </ul>

            <h3>4.3 Ajuste</h3>
            <p><strong>Origen:</strong> Autom√°tico al editar pedido entregado</p>
            <ul>
                <li>Registra diferencia entre total anterior y nuevo</li>
                <li>Puede ser positivo (cliente debe m√°s) o negativo (debe menos)</li>
                <li>Mantiene trazabilidad - cargo original NO se modifica</li>
            </ul>
        </section>

        <!-- PAGOS -->
        <section id="pagos">
            <h2>5. Sistema de Pagos</h2>

            <h3>5.1 M√©todos de pago</h3>
            <table>
                <tr><th>M√©todo</th><th>Descripci√≥n</th><th>Icono</th></tr>
                <tr><td>Efectivo</td><td>Pago en efectivo</td><td>üíµ</td></tr>
                <tr><td>Digital</td><td>MercadoPago, transferencia, d√©bito, cr√©dito</td><td>üí≥</td></tr>
                <tr><td>Mixto</td><td>Combinaci√≥n de ambos (requiere desglose)</td><td>üíµüí≥</td></tr>
            </table>

            <h3>5.2 Pagos asociados vs gen√©ricos</h3>
            <table>
                <tr><th>Tipo</th><th>Cu√°ndo usar</th><th>Efecto en pedido</th></tr>
                <tr>
                    <td><strong>Asociado</strong></td>
                    <td>Cliente especifica "es para el pedido #X"</td>
                    <td>Actualiza <code>monto_pagado</code> del pedido</td>
                </tr>
                <tr>
                    <td><strong>Gen√©rico</strong></td>
                    <td>Cliente transfiere sin especificar</td>
                    <td>Solo reduce saldo CC, NO actualiza pedidos</td>
                </tr>
            </table>

            <h3>5.3 Pagos parciales</h3>
            <p><strong>Regla:</strong> El monto NO tiene que igualar el total del pedido.</p>
            <ul>
                <li>Si paga menos ‚Üí saldo pendiente queda en CC</li>
                <li>Si paga m√°s ‚Üí saldo a favor del cliente</li>
                <li>Permite m√∫ltiples pagos parciales al mismo pedido</li>
            </ul>

            <h3>5.4 Sincronizaci√≥n VENTAS ‚Üî CC</h3>
            <p>Los pagos se pueden registrar desde ambos m√≥dulos:</p>
            <ul>
                <li><strong>Desde VENTAS:</strong> Al marcar pedido como entregado</li>
                <li><strong>Desde CC:</strong> Bot√≥n "+ Registrar pago"</li>
            </ul>
            <p><strong>Sincronizaci√≥n autom√°tica:</strong></p>
            <ul>
                <li>Pago en VENTAS ‚Üí se crea en CC autom√°ticamente</li>
                <li>Pago a pedido espec√≠fico en CC ‚Üí actualiza columna "Pagado" en VENTAS</li>
                <li>Anti-duplicados: sistema verifica antes de crear</li>
            </ul>

            <h3>5.5 Modal "Registrar Pago"</h3>
            <p><strong>Campos:</strong></p>
            <ul>
                <li>Tipo: Pago gen√©rico / Pago a pedido espec√≠fico (dropdown)</li>
                <li>Monto: n√∫mero</li>
                <li>M√©todo: Efectivo / Digital / Ambos</li>
                <li>Si mixto: campos para desglose</li>
                <li>Nota: texto libre (opcional)</li>
            </ul>
            <p><strong>Validaci√≥n mixto:</strong> Suma de efectivo + digital debe igualar monto total</p>
        </section>

        <!-- AJUSTES -->
        <section id="ajustes">
            <h2>6. Ajustes por Edici√≥n de Pedidos</h2>

            <h3>6.1 Cu√°ndo se genera</h3>
            <p>Cuando se edita un pedido ya confirmado/entregado desde m√≥dulo VENTAS.</p>

            <h3>6.2 Regla cr√≠tica</h3>
            <p><strong>El cargo original NUNCA se modifica.</strong> Se crea un nuevo movimiento tipo "Ajuste" con la diferencia.</p>

            <h3>6.3 Ejemplo</h3>
            <p>Pedido original: $10.000 (10 unidades). Cliente devuelve 1 unidad.</p>
            <ol>
                <li>Nuevo total: $9.000</li>
                <li>Sistema crea Ajuste: -$1.000</li>
                <li>Cargo original permanece: +$10.000</li>
                <li>Saldo neto correcto: +$9.000</li>
            </ol>

            <h3>6.4 Campos del ajuste</h3>
            <ul>
                <li>Tipo: "Ajuste"</li>
                <li>Descripci√≥n: "Ajuste pedido #X"</li>
                <li>Monto: diferencia (puede ser + o -)</li>
                <li>Pedido relacionado</li>
                <li>Usuario que edit√≥</li>
                <li>Fecha/hora</li>
                <li>Raz√≥n (opcional)</li>
            </ul>
        </section>

        <!-- INTEGRACI√ìN -->
        <section id="integracion">
            <h2>7. Integraci√≥n con Otros M√≥dulos</h2>

            <h3>7.1 Cotizador</h3>
            <ul>
                <li>Al confirmar pedido con cliente ‚Üí genera Cargo autom√°tico</li>
                <li>Si modo F√ÅBRICA + registra pago ‚Üí genera Pago autom√°tico</li>
                <li>Sin cliente ‚Üí NO genera movimiento en CC</li>
            </ul>

            <h3>7.2 Ventas</h3>
            <ul>
                <li>Muestra columna "Pagado" por pedido (solo pagos asociados)</li>
                <li>Al marcar entregado ‚Üí puede registrar pago</li>
                <li>Al editar pedido ‚Üí genera Ajuste en CC</li>
            </ul>

            <h3>7.3 Clientes</h3>
            <ul>
                <li>Tab "Cuenta Corriente" en detalle de cliente</li>
                <li>Saldo visible en selector de cliente del cotizador</li>
                <li>Badge de saldo en listado de clientes</li>
            </ul>

            <h3>7.4 Exportar</h3>
            <ul>
                <li>Bot√≥n "Exportar Excel" en vista CC</li>
                <li>Incluye todos los movimientos del per√≠odo</li>
                <li>Formato profesional para contador</li>
            </ul>
        </section>

        <footer>
            <p>Bambu CRM V2 - PRD Cuenta Corriente | Actualizado: Enero 2026</p>
            <p><a href="index.html">‚Üê Volver al PRD General</a></p>
        </footer>
    </main>
</body>

</html>
