<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - ConfiguraciÃ³n | Bambu CRM V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>

    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜° MenÃº</button>

    <nav id="sidebar">
        <div class="logo">
            <span>â—†</span> Bambu CRM v2
        </div>

        <div class="nav-group">
            <div class="nav-header">NavegaciÃ³n</div>
            <a href="index.html" class="nav-link">â† PRD General</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">Otros MÃ³dulos</div>
            <a href="cotizador-especificacion.html" class="nav-link">Cotizador</a>
            <a href="ventas.html" class="nav-link">Ventas</a>
            <a href="productos.html" class="nav-link">Productos</a>
            <a href="clientes.html" class="nav-link">Clientes</a>
            <a href="configuracion.html" class="nav-link active">ConfiguraciÃ³n</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">En esta pÃ¡gina</div>
            <ul id="toc" style="list-style: none; padding: 0; margin: 0;">
                <!-- Auto-generado desde los h2 -->
            </ul>
        </div>
    </nav>

    <main>
        <header>
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase;">
                QuÃ­mica Bambu S.R.L.
            </div>
            <h1>PRD: ConfiguraciÃ³n General <br><span style="font-weight: 300; font-size: 1.5rem; color: var(--text-secondary);">ParÃ¡metros del sistema</span></h1>

            <table>
                <tr>
                    <td style="width: 150px;"><strong>VersiÃ³n</strong></td>
                    <td>2.0</td>
                </tr>
                <tr>
                    <td><strong>Fecha</strong></td>
                    <td>31 Diciembre 2024</td>
                </tr>
                <tr>
                    <td><strong>Estado</strong></td>
                    <td>âš ï¸ Borrador (pendiente prototipar y validar)</td>
                </tr>
            </table>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ Nota importante:</strong> Este PRD es documentaciÃ³n modular de referencia. Solo Cotizador y Ventas estÃ¡n prototipados/validados al 100%. El contenido de ConfiguraciÃ³n probablemente cambie al prototipar e implementar.</p>
            </div>
        </header>

        <!-- SECCIÃ“N 1: CONTEXTO Y OBJETIVO -->
        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>1.1 PropÃ³sito del mÃ³dulo</h3>
            <p>El mÃ³dulo <strong>ConfiguraciÃ³n General</strong> centraliza todos los parÃ¡metros del sistema que afectan el comportamiento transversal del CRM. Permite al administrador ajustar precios, vehÃ­culos, ciudades, y reglas de negocio sin tocar cÃ³digo.</p>

            <h3>1.2 Problema que resuelve</h3>
            <ul>
                <li>GestiÃ³n centralizada de parÃ¡metros del sistema</li>
                <li>ConfiguraciÃ³n de listas de precios (L1, L2, L3) y umbrales</li>
                <li>AdministraciÃ³n de vehÃ­culos de reparto</li>
                <li>GestiÃ³n de ciudades habilitadas</li>
                <li>ConfiguraciÃ³n de comportamiento de stock</li>
                <li>Evita hard-coding de valores que deben ser configurables</li>
            </ul>

            <h3>1.3 Usuarios principales</h3>
            <ul>
                <li><strong>Administrador:</strong> Acceso completo a todas las configuraciones</li>
                <li><strong>Vendedor:</strong> SIN ACCESO (mÃ³dulo exclusivo admin)</li>
            </ul>

            <h3>1.4 SimplificaciÃ³n v1 â†’ v2</h3>
            <table>
                <thead>
                    <tr>
                        <th>Aspecto</th>
                        <th>v1</th>
                        <th>v2</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>UbicaciÃ³n configuraciones</td>
                        <td>Dispersas en diferentes mÃ³dulos</td>
                        <td>Centralizadas en un solo mÃ³dulo</td>
                    </tr>
                    <tr>
                        <td>VehÃ­culos</td>
                        <td>Marca/modelo/patente detallados</td>
                        <td>Solo nombre simple ("Reparto 1, 2, 3")</td>
                    </tr>
                    <tr>
                        <td>Listas de precio</td>
                        <td>Fijas en cÃ³digo</td>
                        <td>Configurables desde UI</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECCIÃ“N 2: FUNCIONALIDAD PRINCIPAL -->
        <section id="funcionalidad">
            <h2>2. Funcionalidad Principal</h2>

            <h3>2.1 DescripciÃ³n general</h3>
            <p>El mÃ³dulo ConfiguraciÃ³n General agrupa 4 Ã¡reas principales:</p>
            <ul>
                <li><strong>VehÃ­culos:</strong> CRUD de vehÃ­culos de reparto (nombre, capacidad en kg)</li>
                <li><strong>Ciudades:</strong> CRUD de ciudades disponibles para entregas</li>
                <li><strong>Listas de precios:</strong> ConfiguraciÃ³n de % descuento L2/L3 y umbrales de acceso</li>
                <li><strong>Comportamiento stock:</strong> Bloquear vs advertir cuando no hay stock suficiente</li>
            </ul>

            <p><strong>Nota importante:</strong> CRUD = Create-Read-Update-Delete (alta, consulta, modificaciÃ³n, baja)</p>

            <h3>2.2 CaracterÃ­sticas clave</h3>
            <ul>
                <li>âœ… Acceso exclusivo para administrador</li>
                <li>âœ… CRUD de vehÃ­culos (nombre, capacidad kg)</li>
                <li>âœ… CRUD de ciudades</li>
                <li>âœ… ConfiguraciÃ³n de listas de precios (L2/L3 porcentajes + umbrales)</li>
                <li>âœ… Toggle comportamiento stock (bloquear/advertir)</li>
                <li>âœ… Cambios aplicados inmediatamente en todo el sistema</li>
                <li>âœ… Validaciones para evitar configuraciones invÃ¡lidas</li>
                <li>âœ… Historial de cambios (auditorÃ­a)</li>
            </ul>

            <h3>2.3 Flujo de trabajo tÃ­pico</h3>
            <pre><code>Administrador accede a ConfiguraciÃ³n
        â†“
Ve 4 secciones principales:
â”œâ”€ VehÃ­culos
â”œâ”€ Ciudades
â”œâ”€ Listas de precio
â””â”€ Comportamiento stock
        â†“
Selecciona secciÃ³n a configurar
        â†“
Acciones disponibles:
â”œâ”€ CRUD de elementos (vehÃ­culos/ciudades)
â”œâ”€ Editar parÃ¡metros (listas de precio, stock)
â””â”€ Guardar cambios
        â†“
Sistema aplica cambios inmediatamente</code></pre>
        </section>

        <!-- SECCIÃ“N 3: INTERFAZ DE USUARIO -->
        <section id="interfaz">
            <h2>3. Interfaz de Usuario</h2>

            <h3>3.1 Layout general</h3>
            <p><strong>Vista principal:</strong> Panel con 4 secciones principales en pestaÃ±as o acordeÃ³n</p>

            <p><strong>Estructura:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONFIGURACIÃ“N GENERAL                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PestaÃ±as:  [VehÃ­culos] [Ciudades] [Precios] [Stock]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  [Contenido de la pestaÃ±a activa]                       â”‚
â”‚                                                          â”‚
â”‚  [BotÃ³n Guardar cambios]                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>3.2 PestaÃ±a: VehÃ­culos</h3>
            <p><strong>Contenido:</strong> Tabla de vehÃ­culos de reparto + BotÃ³n [+ Agregar vehÃ­culo]</p>

            <p><strong>Tabla de vehÃ­culos:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Columna</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Nombre</strong></td>
                        <td>Nombre del vehÃ­culo (ej: "Reparto 1", "Reparto 2")</td>
                    </tr>
                    <tr>
                        <td><strong>Capacidad (kg)</strong></td>
                        <td>Capacidad mÃ¡xima de carga en kilogramos</td>
                    </tr>
                    <tr>
                        <td><strong>Acciones</strong></td>
                        <td>Botones: [Editar] [Eliminar]</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Modal: Crear/Editar VehÃ­culo</strong></p>
            <ul>
                <li><strong>Nombre:</strong> Text input (obligatorio, Ãºnico)</li>
                <li><strong>Capacidad (kg):</strong> Number input (obligatorio, mayor a 0)</li>
                <li><strong>Botones:</strong> [Cancelar] [Guardar]</li>
            </ul>

            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>â­ SimplificaciÃ³n v2:</strong> Solo nombre y capacidad. Se eliminaron campos innecesarios como marca, modelo, patente, color. Nomenclatura simple: "Reparto 1", "Reparto 2", "Reparto 3".</p>
            </div>

            <h3>3.3 PestaÃ±a: Ciudades</h3>
            <p><strong>Contenido:</strong> Lista de ciudades habilitadas + BotÃ³n [+ Agregar ciudad]</p>

            <p><strong>Lista de ciudades:</strong></p>
            <ul>
                <li>NeuquÃ©n</li>
                <li>Plottier</li>
                <li>Centenario</li>
                <li>San MartÃ­n de los Andes</li>
                <li>Bariloche</li>
                <li>... (otras ciudades configuradas)</li>
            </ul>

            <p><strong>Acciones por ciudad:</strong></p>
            <ul>
                <li>[Editar]: Cambiar nombre de la ciudad</li>
                <li>[Eliminar]: Borrar ciudad (solo si no tiene clientes asociados)</li>
            </ul>

            <p><strong>Modal: Crear/Editar Ciudad</strong></p>
            <ul>
                <li><strong>Nombre:</strong> Text input (obligatorio, Ãºnico)</li>
                <li><strong>Botones:</strong> [Cancelar] [Guardar]</li>
            </ul>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ RestricciÃ³n de eliminaciÃ³n:</strong> No se puede eliminar una ciudad que tenga clientes asociados. Mensaje: "No se puede eliminar esta ciudad porque tiene X clientes asociados".</p>
            </div>

            <h3>3.4 PestaÃ±a: Listas de Precio</h3>
            <p><strong>Contenido:</strong> Formulario de configuraciÃ³n de listas L1, L2, L3</p>

            <p><strong>Estructura:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LISTA 1 (L1) - Precio base                    â”‚
â”‚  â””â”€ Precio de referencia (sin descuento)       â”‚
â”‚                                                 â”‚
â”‚  LISTA 2 (L2)                                   â”‚
â”‚  â””â”€ Descuento: [ 6.25 ] %                      â”‚
â”‚  â””â”€ Umbral mÃ­nimo: [ $10,000 ] (opcional)      â”‚
â”‚                                                 â”‚
â”‚  LISTA 3 (L3)                                   â”‚
â”‚  â””â”€ Descuento: [ 10.00 ] %                     â”‚
â”‚  â””â”€ Umbral mÃ­nimo: [ $20,000 ] (opcional)      â”‚
â”‚                                                 â”‚
â”‚  [Guardar cambios]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Campos configurables:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Tipo</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Descuento L2 (%)</strong></td>
                        <td>Number</td>
                        <td>Porcentaje de descuento sobre L1 (default: 6.25%)</td>
                    </tr>
                    <tr>
                        <td><strong>Descuento L3 (%)</strong></td>
                        <td>Number</td>
                        <td>Porcentaje de descuento sobre L1 (default: 10%)</td>
                    </tr>
                    <tr>
                        <td><strong>Umbral L2 ($)</strong></td>
                        <td>Number (opcional)</td>
                        <td>Monto mÃ­nimo de pedido para acceder a L2 (si se usa)</td>
                    </tr>
                    <tr>
                        <td><strong>Umbral L3 ($)</strong></td>
                        <td>Number (opcional)</td>
                        <td>Monto mÃ­nimo de pedido para acceder a L3 (si se usa)</td>
                    </tr>
                </tbody>
            </table>

            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>ğŸ’¡ Umbrales de acceso:</strong> Si se configuran umbrales, el cotizador solo permitirÃ¡ seleccionar L2/L3 si el subtotal del pedido supera esos montos. Dejar en blanco para permitir acceso sin restricciones.</p>
            </div>

            <h3>3.5 PestaÃ±a: Comportamiento Stock</h3>
            <p><strong>Contenido:</strong> Toggle para configurar quÃ© hace el sistema cuando no hay stock suficiente</p>

            <p><strong>Opciones:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  COMPORTAMIENTO CUANDO NO HAY STOCK SUFICIENTE â”‚
â”‚                                                 â”‚
â”‚  â—‹ Bloquear venta (no permite confirmar)       â”‚
â”‚  â— Advertir pero permitir (solo muestra alerta)â”‚
â”‚                                                 â”‚
â”‚  Nota: Productos del proveedor "BAMBU" siempre â”‚
â”‚  permiten stock negativo sin lÃ­mite.           â”‚
â”‚                                                 â”‚
â”‚  [Guardar cambios]                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <p><strong>Comportamiento segÃºn configuraciÃ³n:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>OpciÃ³n</th>
                        <th>Comportamiento</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Bloquear venta</strong></td>
                        <td>Si no hay stock suficiente, el botÃ³n "Confirmar pedido" queda deshabilitado con mensaje: "Stock insuficiente en: [producto]"</td>
                    </tr>
                    <tr>
                        <td><strong>Advertir pero permitir</strong></td>
                        <td>Muestra alerta âš ï¸ "Stock insuficiente en: [producto]" pero permite confirmar de todos modos (stock queda negativo)</td>
                    </tr>
                </tbody>
            </table>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ ExcepciÃ³n proveedor BAMBU:</strong> Los productos del proveedor "BAMBU" (producciÃ³n propia) siempre pueden tener stock negativo sin lÃ­mite, sin importar esta configuraciÃ³n. Esto permite seguir vendiendo mientras se produce mÃ¡s.</p>
            </div>
        </section>

        <!-- SECCIÃ“N 4: REGLAS DE NEGOCIO -->
        <section id="reglas">
            <h2>4. Reglas de Negocio EspecÃ­ficas</h2>

            <h3>4.1 Validaciones - VehÃ­culos</h3>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>ValidaciÃ³n</th>
                        <th>Mensaje de error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Nombre</strong></td>
                        <td>Ãšnico, no puede haber 2 vehÃ­culos con mismo nombre</td>
                        <td>"Ya existe un vehÃ­culo con este nombre"</td>
                    </tr>
                    <tr>
                        <td><strong>Capacidad (kg)</strong></td>
                        <td>Mayor a 0</td>
                        <td>"La capacidad debe ser mayor a 0"</td>
                    </tr>
                    <tr>
                        <td><strong>Eliminar vehÃ­culo</strong></td>
                        <td>No puede tener pedidos asignados</td>
                        <td>"No se puede eliminar este vehÃ­culo porque tiene X pedidos asignados"</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.2 Validaciones - Ciudades</h3>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>ValidaciÃ³n</th>
                        <th>Mensaje de error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Nombre</strong></td>
                        <td>Ãšnico, no puede haber 2 ciudades con mismo nombre</td>
                        <td>"Ya existe una ciudad con este nombre"</td>
                    </tr>
                    <tr>
                        <td><strong>Eliminar ciudad</strong></td>
                        <td>No puede tener clientes asociados</td>
                        <td>"No se puede eliminar esta ciudad porque tiene X clientes asociados"</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.3 Validaciones - Listas de precio</h3>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>ValidaciÃ³n</th>
                        <th>Mensaje de error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Descuento L2 (%)</strong></td>
                        <td>Entre 0% y 100%</td>
                        <td>"El descuento debe estar entre 0 y 100"</td>
                    </tr>
                    <tr>
                        <td><strong>Descuento L3 (%)</strong></td>
                        <td>Entre 0% y 100%, mayor que L2</td>
                        <td>"L3 debe ser mayor que L2"</td>
                    </tr>
                    <tr>
                        <td><strong>Umbral L2 ($)</strong></td>
                        <td>Mayor a 0 (si se completa)</td>
                        <td>"El umbral debe ser mayor a 0"</td>
                    </tr>
                    <tr>
                        <td><strong>Umbral L3 ($)</strong></td>
                        <td>Mayor que umbral L2 (si se completa)</td>
                        <td>"El umbral L3 debe ser mayor que L2"</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.4 Impacto de cambios en el sistema</h3>
            <p><strong>Cambios en listas de precio:</strong></p>
            <ul>
                <li>Se aplican inmediatamente a todos los pedidos nuevos</li>
                <li>Los pedidos existentes (borradores o confirmados) NO se modifican</li>
                <li>Al editar un pedido existente, se recalculan precios con la configuraciÃ³n actual</li>
            </ul>

            <p><strong>Cambios en vehÃ­culos:</strong></p>
            <ul>
                <li>Se aplican inmediatamente en calendario de repartos</li>
                <li>Los pedidos ya asignados a un vehÃ­culo mantienen la asignaciÃ³n</li>
                <li>Si se elimina un vehÃ­culo, sus pedidos asignados quedan "sin vehÃ­culo"</li>
            </ul>

            <p><strong>Cambios en ciudades:</strong></p>
            <ul>
                <li>Se aplican inmediatamente en dropdowns de clientes y filtros</li>
                <li>Los clientes con ciudades eliminadas mantienen el valor (pero aparece como "Ciudad invÃ¡lida")</li>
            </ul>

            <p><strong>Cambios en comportamiento stock:</strong></p>
            <ul>
                <li>Se aplican inmediatamente en el cotizador</li>
                <li>No afecta pedidos ya confirmados</li>
            </ul>

            <h3>4.5 Regla especial: Productos del proveedor BAMBU</h3>
            <p><strong>Comportamiento:</strong></p>
            <ul>
                <li>Los productos del proveedor "BAMBU" (producciÃ³n propia) pueden tener stock negativo sin lÃ­mite</li>
                <li>Esto permite seguir vendiendo mientras se produce mÃ¡s</li>
                <li>La configuraciÃ³n "Bloquear venta" NO aplica para productos BAMBU</li>
                <li>Solo muestra advertencia informativa: â„¹ï¸ "Stock negativo en producto BAMBU: X unidades"</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 5: INTEGRACIÃ“N -->
        <section id="integracion">
            <h2>5. IntegraciÃ³n con Otros MÃ³dulos</h2>

            <h3>5.1 Cotizador</h3>
            <p><strong>RelaciÃ³n:</strong> El cotizador consume configuraciÃ³n de precios y stock</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Listas de precio (L1/L2/L3) se calculan segÃºn % configurados</li>
                <li>Umbrales de acceso a L2/L3 se validan al seleccionar lista</li>
                <li>Comportamiento stock (bloquear/advertir) se aplica al confirmar pedido</li>
                <li>Productos BAMBU siempre permiten stock negativo</li>
            </ul>

            <h3>5.2 Ventas (Calendario de Repartos)</h3>
            <p><strong>RelaciÃ³n:</strong> El calendario de repartos muestra vehÃ­culos configurados</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>VehÃ­culos configurados aparecen como opciones en asignaciÃ³n de pedidos</li>
                <li>Capacidad (kg) se usa para calcular carga total por vehÃ­culo</li>
                <li>Si se elimina vehÃ­culo, pedidos asignados quedan "sin vehÃ­culo"</li>
            </ul>

            <h3>5.3 Productos</h3>
            <p><strong>RelaciÃ³n:</strong> Los productos calculan precios segÃºn listas configuradas</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Precio L1 se ingresa manualmente en producto</li>
                <li>Precio L2 = L1 - (L1 * descuento_l2_porciento / 100)</li>
                <li>Precio L3 = L1 - (L1 * descuento_l3_porciento / 100)</li>
                <li>Productos en promociÃ³n ignoran listas (precio fijo)</li>
            </ul>

            <h3>5.4 Clientes</h3>
            <p><strong>RelaciÃ³n:</strong> Los clientes usan ciudades configuradas</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Dropdown de ciudad en formulario cliente consume lista configurada</li>
                <li>Filtros por ciudad en tabla clientes usan ciudades configuradas</li>
                <li>Si se elimina ciudad, clientes asociados quedan con "Ciudad invÃ¡lida"</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 6: CASOS DE USO -->
        <section id="casos-uso">
            <h2>6. Casos de Uso</h2>

            <h3>Caso 1: Agregar nuevo vehÃ­culo de reparto</h3>
            <p><strong>Contexto:</strong> La empresa adquiere un vehÃ­culo nuevo para repartos</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "VehÃ­culos"</li>
                <li>Click en [+ Agregar vehÃ­culo]</li>
                <li>Completa formulario:
                    <ul>
                        <li>Nombre: "Reparto 4"</li>
                        <li>Capacidad: 800 kg</li>
                    </ul>
                </li>
                <li>Click [Guardar]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… VehÃ­culo creado correctamente</li>
                <li>âœ… Aparece en tabla de vehÃ­culos</li>
                <li>âœ… Ya disponible en calendario de repartos para asignar pedidos</li>
            </ul>

            <h3>Caso 2: Modificar descuento de lista L2</h3>
            <p><strong>Contexto:</strong> La empresa decide aumentar descuento L2 de 6.25% a 7%</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "Listas de Precio"</li>
                <li>Cambia campo "Descuento L2": de 6.25% a 7%</li>
                <li>Click [Guardar cambios]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… ConfiguraciÃ³n actualizada</li>
                <li>âœ… Todos los pedidos nuevos usan L2 = L1 - 7%</li>
                <li>âœ… Pedidos existentes NO se modifican</li>
                <li>âœ… Al editar pedido existente, se recalcula con nuevo 7%</li>
            </ul>

            <h3>Caso 3: Agregar nueva ciudad</h3>
            <p><strong>Contexto:</strong> La empresa comienza a hacer entregas en Cipolletti</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "Ciudades"</li>
                <li>Click en [+ Agregar ciudad]</li>
                <li>Nombre: "Cipolletti"</li>
                <li>Click [Guardar]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Ciudad agregada correctamente</li>
                <li>âœ… Aparece en dropdown de ciudades en formulario cliente</li>
                <li>âœ… Aparece en filtro de ciudades en tabla clientes</li>
            </ul>

            <h3>Caso 4: Cambiar comportamiento stock</h3>
            <p><strong>Contexto:</strong> La empresa decide bloquear ventas cuando no hay stock (antes solo advertÃ­a)</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "Comportamiento Stock"</li>
                <li>Cambia de "Advertir pero permitir" a "Bloquear venta"</li>
                <li>Click [Guardar cambios]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… ConfiguraciÃ³n actualizada</li>
                <li>âœ… Al crear pedido en cotizador, si no hay stock suficiente:
                    <ul>
                        <li>BotÃ³n "Confirmar pedido" se deshabilita</li>
                        <li>Mensaje: âŒ "Stock insuficiente en: [producto]"</li>
                    </ul>
                </li>
                <li>âœ… Productos BAMBU siguen permitiendo stock negativo (excepciÃ³n)</li>
            </ul>

            <h3>Caso 5: Intentar eliminar vehÃ­culo con pedidos asignados</h3>
            <p><strong>Contexto:</strong> Administrador quiere eliminar "Reparto 2" pero tiene pedidos asignados</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "VehÃ­culos"</li>
                <li>Click en [Eliminar] en "Reparto 2"</li>
                <li>Modal de confirmaciÃ³n: "Â¿Eliminar vehÃ­culo Reparto 2?"</li>
                <li>Click [Confirmar]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âŒ OperaciÃ³n bloqueada</li>
                <li>âš ï¸ Mensaje: "No se puede eliminar este vehÃ­culo porque tiene 15 pedidos asignados"</li>
                <li>ğŸ’¡ Sugerencia: "Reasigne los pedidos a otro vehÃ­culo antes de eliminar"</li>
            </ul>

            <h3>Caso 6: Configurar umbrales de acceso a listas</h3>
            <p><strong>Contexto:</strong> La empresa quiere que L2 solo estÃ© disponible si el pedido supera $10.000 y L3 si supera $20.000</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre ConfiguraciÃ³n â†’ PestaÃ±a "Listas de Precio"</li>
                <li>Completa umbrales:
                    <ul>
                        <li>Umbral L2: $10.000</li>
                        <li>Umbral L3: $20.000</li>
                    </ul>
                </li>
                <li>Click [Guardar cambios]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… ConfiguraciÃ³n guardada</li>
                <li>âœ… En cotizador, al seleccionar lista:
                    <ul>
                        <li>Si subtotal < $10.000 â†’ Solo L1 disponible</li>
                        <li>Si subtotal >= $10.000 â†’ L1 y L2 disponibles</li>
                        <li>Si subtotal >= $20.000 â†’ L1, L2 y L3 disponibles</li>
                    </ul>
                </li>
                <li>âœ… Listas bloqueadas aparecen deshabilitadas con tooltip explicativo</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 7: FLUJOS DE USUARIO -->
        <section id="flujos">
            <h2>7. Flujos de Usuario</h2>

            <h3>7.1 Flujo principal: GestiÃ³n de vehÃ­culos</h3>
            <pre><code>Administrador accede a ConfiguraciÃ³n
        â†“
Selecciona pestaÃ±a "VehÃ­culos"
        â†“
Ve tabla con vehÃ­culos existentes
        â†“
Acciones disponibles:
â”œâ”€ [+ Agregar vehÃ­culo] â†’ Modal crear â†’ Guardar â†’ VehÃ­culo agregado
â”œâ”€ [Editar] â†’ Modal editar â†’ Guardar â†’ VehÃ­culo actualizado
â””â”€ [Eliminar] â†’ ConfirmaciÃ³n â†’ ValidaciÃ³n:
    â”œâ”€ Si tiene pedidos asignados â†’ âŒ Bloqueado + mensaje error
    â””â”€ Si NO tiene pedidos â†’ âœ… VehÃ­culo eliminado</code></pre>

            <h3>7.2 Flujo: Modificar listas de precio</h3>
            <pre><code>Administrador accede a ConfiguraciÃ³n
        â†“
Selecciona pestaÃ±a "Listas de Precio"
        â†“
Ve formulario con configuraciÃ³n actual:
â”œâ”€ Descuento L2: 6.25%
â”œâ”€ Descuento L3: 10%
â”œâ”€ Umbral L2: (vacÃ­o)
â””â”€ Umbral L3: (vacÃ­o)
        â†“
Modifica valores segÃºn necesidad
        â†“
Click [Guardar cambios]
        â†“
Sistema valida:
â”œâ”€ L3 > L2 âœ“
â”œâ”€ Umbral L3 > Umbral L2 âœ“
â””â”€ Valores entre 0-100% âœ“
        â†“
ConfiguraciÃ³n guardada
        â†“
NotificaciÃ³n: âœ… "Listas de precio actualizadas"
        â†“
Cambios aplicados inmediatamente en cotizador</code></pre>

            <h3>7.3 Flujo: Cambiar comportamiento stock</h3>
            <pre><code>Administrador accede a ConfiguraciÃ³n
        â†“
Selecciona pestaÃ±a "Comportamiento Stock"
        â†“
Ve toggle con opciÃ³n actual seleccionada:
â— Advertir pero permitir
â—‹ Bloquear venta
        â†“
Cambia selecciÃ³n a "Bloquear venta"
        â†“
Click [Guardar cambios]
        â†“
Sistema aplica cambio inmediatamente
        â†“
NotificaciÃ³n: âœ… "Comportamiento de stock actualizado"
        â†“
Impacto en cotizador:
â””â”€ Al confirmar pedido sin stock suficiente:
    â”œâ”€ BotÃ³n "Confirmar" deshabilitado
    â”œâ”€ Mensaje: âŒ "Stock insuficiente en: [producto]"
    â””â”€ ExcepciÃ³n: Productos BAMBU siguen permitiendo stock negativo</code></pre>

            <h3>7.4 Flujo: Agregar nueva ciudad</h3>
            <pre><code>Administrador accede a ConfiguraciÃ³n
        â†“
Selecciona pestaÃ±a "Ciudades"
        â†“
Ve lista de ciudades existentes:
- NeuquÃ©n
- Plottier
- Centenario
        â†“
Click [+ Agregar ciudad]
        â†“
Modal muestra formulario:
â””â”€ Nombre: [input texto]
        â†“
Completa: "Cipolletti"
        â†“
Click [Guardar]
        â†“
Sistema valida:
â””â”€ Nombre Ãºnico âœ“
        â†“
Ciudad agregada a la lista
        â†“
NotificaciÃ³n: âœ… "Ciudad agregada correctamente"
        â†“
Impacto en mÃ³dulo Clientes:
â”œâ”€ Aparece en dropdown de ciudades
â””â”€ Aparece en filtro de tabla clientes</code></pre>
        </section>

        <!-- SECCIÃ“N 8: NOTAS TÃ‰CNICAS -->
        <section id="notas-tecnicas">
            <h2>8. Notas TÃ©cnicas para Desarrollo</h2>

            <h3>8.1 Estructura de datos (Mock data)</h3>
            <pre><code class="language-javascript">// ConfiguraciÃ³n de listas de precio
const CONFIG_LISTAS_PRECIO = {
    l2_descuento_porciento: 6.25, // % descuento sobre L1
    l3_descuento_porciento: 10.00, // % descuento sobre L1
    l2_umbral_minimo: null, // null = sin umbral (siempre disponible)
    l3_umbral_minimo: null, // o monto en pesos (ej: 20000)
};

// ConfiguraciÃ³n de stock
const CONFIG_STOCK = {
    comportamiento: "ADVERTIR", // "ADVERTIR" | "BLOQUEAR"
};

// VehÃ­culo
const VEHICULO_EJEMPLO = {
    id: 1,
    nombre: "Reparto 1",
    capacidad_kg: 800,
    created_at: "2024-01-10",
    updated_at: "2024-12-30"
};

// Ciudad
const CIUDAD_EJEMPLO = {
    id: 1,
    nombre: "NeuquÃ©n",
    created_at: "2024-01-10",
    updated_at: "2024-12-30"
};
</code></pre>

            <h3>8.2 Consideraciones de implementaciÃ³n</h3>
            <ul>
                <li>âš ï¸ <strong>ConfiguraciÃ³n global:</strong> Usar tabla <code>configuracion</code> con clave-valor para almacenar parÃ¡metros</li>
                <li>âš ï¸ <strong>Cache:</strong> Cachear configuraciÃ³n en memoria para evitar queries repetidos</li>
                <li>âš ï¸ <strong>Invalidar cache:</strong> Al guardar cambios, invalidar cache de configuraciÃ³n</li>
                <li>âš ï¸ <strong>Validaciones:</strong> Validar restricciones en backend (no solo frontend)</li>
                <li>âš ï¸ <strong>AuditorÃ­a:</strong> Registrar todos los cambios de configuraciÃ³n (quiÃ©n, cuÃ¡ndo, quÃ©)</li>
                <li>ğŸ’¡ <strong>Historial:</strong> Guardar historial de cambios de configuraciÃ³n para trazabilidad</li>
                <li>ğŸ’¡ <strong>Rollback:</strong> Permitir revertir configuraciÃ³n a versiÃ³n anterior (funcionalidad futura)</li>
            </ul>

            <h3>8.3 Queries SQL Ãºtiles</h3>
            <pre><code class="language-sql">-- Obtener configuraciÃ³n actual
SELECT clave, valor
FROM configuracion
WHERE clave IN ('l2_descuento', 'l3_descuento', 'stock_comportamiento');

-- Obtener vehÃ­culos con cantidad de pedidos asignados
SELECT v.*, COUNT(p.id) as pedidos_asignados
FROM vehiculos v
LEFT JOIN pedidos p ON v.id = p.vehiculo_id
GROUP BY v.id
ORDER BY v.nombre ASC;

-- Obtener ciudades con cantidad de clientes
SELECT c.*, COUNT(cl.id) as clientes_asociados
FROM ciudades c
LEFT JOIN clientes cl ON c.nombre = cl.ciudad
GROUP BY c.id
ORDER BY c.nombre ASC;

-- Verificar si se puede eliminar vehÃ­culo
SELECT COUNT(*) as pedidos_asignados
FROM pedidos
WHERE vehiculo_id = ?;</code></pre>

            <h3>8.4 Estructura de base de datos sugerida</h3>
            <pre><code class="language-sql">-- Tabla de configuraciÃ³n global (clave-valor)
CREATE TABLE configuracion (
    clave VARCHAR(100) PRIMARY KEY,
    valor TEXT NOT NULL,
    descripcion TEXT,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Insertar configuraciÃ³n por defecto
INSERT INTO configuracion (clave, valor, descripcion) VALUES
('l2_descuento_porciento', '6.25', 'Porcentaje descuento lista 2'),
('l3_descuento_porciento', '10.00', 'Porcentaje descuento lista 3'),
('l2_umbral_minimo', NULL, 'Umbral mÃ­nimo acceso L2 (null = sin umbral)'),
('l3_umbral_minimo', NULL, 'Umbral mÃ­nimo acceso L3 (null = sin umbral)'),
('stock_comportamiento', 'ADVERTIR', 'ADVERTIR o BLOQUEAR');

-- Tabla de vehÃ­culos
CREATE TABLE vehiculos (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) UNIQUE NOT NULL,
    capacidad_kg INT NOT NULL CHECK (capacidad_kg > 0),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de ciudades
CREATE TABLE ciudades (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100) UNIQUE NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de historial de cambios de configuraciÃ³n (auditorÃ­a)
CREATE TABLE configuracion_historial (
    id SERIAL PRIMARY KEY,
    clave VARCHAR(100) NOT NULL,
    valor_anterior TEXT,
    valor_nuevo TEXT,
    usuario_id INT REFERENCES usuarios(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);</code></pre>

            <h3>8.5 CÃ¡lculo de precios por lista</h3>
            <pre><code class="language-javascript">// FunciÃ³n para calcular precio segÃºn lista
function calcularPrecioConLista(precioL1, lista, config) {
    // Si es producto en promociÃ³n, usar precio promocional (fijo)
    if (producto.en_promocion) {
        return producto.precio_promocional;
    }

    // Calcular precio segÃºn lista
    switch(lista) {
        case 'L1':
            return precioL1;
        case 'L2':
            const descuentoL2 = config.l2_descuento_porciento / 100;
            return precioL1 - (precioL1 * descuentoL2);
        case 'L3':
            const descuentoL3 = config.l3_descuento_porciento / 100;
            return precioL1 - (precioL1 * descuentoL3);
        default:
            return precioL1;
    }
}

// FunciÃ³n para validar acceso a lista segÃºn umbral
function puedeAccederLista(subtotal, lista, config) {
    if (lista === 'L1') return true; // L1 siempre disponible

    if (lista === 'L2') {
        if (!config.l2_umbral_minimo) return true; // Sin umbral = siempre disponible
        return subtotal >= config.l2_umbral_minimo;
    }

    if (lista === 'L3') {
        if (!config.l3_umbral_minimo) return true;
        return subtotal >= config.l3_umbral_minimo;
    }

    return false;
}
</code></pre>
        </section>

        <!-- PIE DE PÃGINA -->
        <footer>
            <p>Bambu CRM V2 - PRD TÃ©cnico | Ãšltima actualizaciÃ³n: 31 Diciembre 2024</p>
            <p><a href="index.html">â† Volver al PRD General</a></p>
        </footer>
    </main>

    <!-- SCRIPT PARA TOC AUTO -->
    <script>
        // Auto-generar tabla de contenidos desde los h2
        const toc = document.getElementById('toc');
        const h2s = document.querySelectorAll('main h2');
        h2s.forEach(h2 => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + h2.parentElement.id;
            a.textContent = h2.textContent;
            a.className = 'nav-link';
            li.appendChild(a);
            toc.appendChild(li);
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-toggle')?.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });
    </script>
</body>

</html>
