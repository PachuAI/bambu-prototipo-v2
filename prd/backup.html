<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - Backup y Logs | Bambu CRM V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>

    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜° MenÃº</button>

    <nav id="sidebar">
        <div class="logo">
            <span>â—†</span> Bambu CRM v2
        </div>

        <div class="nav-group">
            <div class="nav-header">NavegaciÃ³n</div>
            <a href="index.html" class="nav-link">â† PRD General</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">Otros MÃ³dulos</div>
            <a href="configuracion.html" class="nav-link">ConfiguraciÃ³n</a>
            <a href="backup.html" class="nav-link active">Backup y Logs</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">En esta pÃ¡gina</div>
            <ul id="toc" style="list-style: none; padding: 0; margin: 0;">
                <!-- Auto-generado desde los h2 -->
            </ul>
        </div>
    </nav>

    <main>
        <header>
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase;">
                QuÃ­mica Bambu S.R.L.
            </div>
            <h1>PRD: Backup y Logs <br><span style="font-weight: 300; font-size: 1.5rem; color: var(--text-secondary);">Respaldos y auditorÃ­a del sistema</span></h1>

            <table>
                <tr>
                    <td style="width: 150px;"><strong>VersiÃ³n</strong></td>
                    <td>2.0</td>
                </tr>
                <tr>
                    <td><strong>Fecha</strong></td>
                    <td>31 Diciembre 2024</td>
                </tr>
                <tr>
                    <td><strong>Estado</strong></td>
                    <td>âš ï¸ Borrador (pendiente prototipar y validar)</td>
                </tr>
            </table>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ Nota importante:</strong> Este PRD es documentaciÃ³n modular de referencia. Solo Cotizador y Ventas estÃ¡n prototipados/validados al 100%. El contenido de Backup y Logs probablemente cambie al prototipar e implementar.</p>
            </div>
        </header>

        <!-- SECCIÃ“N 1: CONTEXTO Y OBJETIVO -->
        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>1.1 PropÃ³sito del mÃ³dulo</h3>
            <p>El mÃ³dulo <strong>Backup y Logs</strong> provee herramientas crÃ­ticas para seguridad de datos y auditorÃ­a del sistema. Permite crear respaldos de la base de datos, restaurar desde respaldos existentes, y consultar logs de actividad del sistema.</p>

            <h3>1.2 Problema que resuelve</h3>
            <ul>
                <li>ProtecciÃ³n de datos mediante respaldos periÃ³dicos</li>
                <li>RecuperaciÃ³n ante fallas o pÃ©rdida de datos</li>
                <li>AuditorÃ­a de accesos y cambios crÃ­ticos</li>
                <li>Trazabilidad de operaciones del sistema</li>
                <li>Cumplimiento de polÃ­ticas de seguridad</li>
            </ul>

            <h3>1.3 Usuarios principales</h3>
            <ul>
                <li><strong>Administrador:</strong> Acceso completo (Ãºnico usuario con acceso)</li>
                <li><strong>Vendedor:</strong> SIN ACCESO (mÃ³dulo exclusivo admin)</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 2: FUNCIONALIDAD PRINCIPAL -->
        <section id="funcionalidad">
            <h2>2. Funcionalidad Principal</h2>

            <h3>2.1 DescripciÃ³n general</h3>
            <p>El mÃ³dulo se divide en 2 Ã¡reas principales:</p>
            <ul>
                <li><strong>Backup (Respaldos):</strong> Crear y restaurar respaldos de la base de datos</li>
                <li><strong>Logs (AuditorÃ­a):</strong> Consultar registros de accesos y cambios crÃ­ticos</li>
            </ul>

            <h3>2.2 CaracterÃ­sticas clave</h3>
            <ul>
                <li>âœ… Crear respaldo manual de base de datos (dump SQL)</li>
                <li>âœ… Descargar archivo de respaldo (.sql o .zip)</li>
                <li>âœ… Restaurar desde respaldo (upload archivo)</li>
                <li>âœ… Historial de respaldos con fecha y tamaÃ±o</li>
                <li>âœ… Registro de accesos al sistema (login/logout)</li>
                <li>âœ… Registro de cambios crÃ­ticos en stock</li>
                <li>âœ… Filtrado de logs por fecha, usuario, tipo de evento</li>
            </ul>

            <h3>2.3 Flujo de trabajo tÃ­pico</h3>
            <pre><code>Administrador accede a Backup y Logs
        â†“
Ve 2 pestaÃ±as:
â”œâ”€ Backup (Respaldos)
â””â”€ Logs (AuditorÃ­a)
        â†“
En Backup:
â”œâ”€ [Crear respaldo] â†’ Genera archivo .sql
â”œâ”€ Ver historial de respaldos â†’ Descargar/Eliminar
â””â”€ [Restaurar desde archivo] â†’ Upload .sql
        â†“
En Logs:
â”œâ”€ Filtrar por fecha/usuario/tipo
â””â”€ Ver tabla cronolÃ³gica de eventos</code></pre>
        </section>

        <!-- SECCIÃ“N 3: INTERFAZ DE USUARIO -->
        <section id="interfaz">
            <h2>3. Interfaz de Usuario</h2>

            <h3>3.1 Layout general</h3>
            <p><strong>Vista principal:</strong> Pantalla con 2 pestaÃ±as</p>

            <p><strong>Estructura:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKUP Y LOGS                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PestaÃ±as:  [Backup] [Logs]                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  [Contenido de la pestaÃ±a activa]                       â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>3.2 PestaÃ±a: Backup (Respaldos)</h3>
            <p><strong>Contenido:</strong></p>

            <p><strong>SecciÃ³n superior:</strong></p>
            <ul>
                <li>BotÃ³n [Crear respaldo ahora]</li>
                <li>BotÃ³n [Restaurar desde archivo]</li>
            </ul>

            <p><strong>Historial de respaldos:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Fecha</th>
                        <th>TamaÃ±o</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>31/12/2024 14:30</td>
                        <td>2.5 MB</td>
                        <td>[Descargar] [Eliminar]</td>
                    </tr>
                    <tr>
                        <td>30/12/2024 23:00</td>
                        <td>2.4 MB</td>
                        <td>[Descargar] [Eliminar]</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Crear respaldo:</strong></p>
            <ul>
                <li>Click en [Crear respaldo ahora]</li>
                <li>Sistema genera dump de base de datos (archivo .sql)</li>
                <li>Archivo se descarga automÃ¡ticamente: <code>bambu_backup_YYYY-MM-DD_HH-MM-SS.sql</code></li>
                <li>Backup queda registrado en historial</li>
            </ul>

            <p><strong>Restaurar desde archivo:</strong></p>
            <ul>
                <li>Click en [Restaurar desde archivo]</li>
                <li>Modal se abre con:
                    <ul>
                        <li>Input file (solo archivos .sql)</li>
                        <li>âš ï¸ Advertencia: "Esta acciÃ³n sobrescribirÃ¡ todos los datos actuales. Â¿EstÃ¡s seguro?"</li>
                        <li>Botones: [Cancelar] [Restaurar]</li>
                    </ul>
                </li>
                <li>Usuario selecciona archivo .sql</li>
                <li>Click [Restaurar] â†’ Sistema ejecuta SQL y restaura datos</li>
            </ul>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ PrecauciÃ³n:</strong> Restaurar desde backup sobrescribe TODOS los datos actuales. Se recomienda crear un backup antes de restaurar.</p>
            </div>

            <h3>3.3 PestaÃ±a: Logs (AuditorÃ­a)</h3>
            <p><strong>Contenido:</strong></p>

            <p><strong>Filtros superiores:</strong></p>
            <ul>
                <li>Desde (fecha)</li>
                <li>Hasta (fecha)</li>
                <li>Usuario (dropdown)</li>
                <li>Tipo de evento (dropdown):
                    <ul>
                        <li>Todos</li>
                        <li>Accesos (login/logout)</li>
                        <li>Cambios en stock</li>
                        <li>Cambios en configuraciÃ³n</li>
                    </ul>
                </li>
                <li>Botones: [Aplicar filtros] [Limpiar filtros]</li>
            </ul>

            <p><strong>Tabla de logs:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Fecha/Hora</th>
                        <th>Usuario</th>
                        <th>Tipo</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>31/12/2024 14:35</td>
                        <td>admin@bambu.com</td>
                        <td>Stock</td>
                        <td>Ajuste manual: Detergente X (+100 un)</td>
                    </tr>
                    <tr>
                        <td>31/12/2024 14:20</td>
                        <td>admin@bambu.com</td>
                        <td>Acceso</td>
                        <td>Login exitoso</td>
                    </tr>
                    <tr>
                        <td>30/12/2024 23:05</td>
                        <td>admin@bambu.com</td>
                        <td>ConfiguraciÃ³n</td>
                        <td>ModificÃ³ lista L2: 6.25% â†’ 7%</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>Ordenamiento:</strong></p>
            <ul>
                <li>Default: Por fecha descendente (mÃ¡s recientes primero)</li>
                <li>Clickeable en headers para ordenar por cualquier columna</li>
            </ul>

            <h3>3.4 Tipos de eventos registrados</h3>
            <p><strong>Accesos:</strong></p>
            <ul>
                <li>Login exitoso</li>
                <li>Login fallido (credenciales incorrectas)</li>
                <li>Logout</li>
            </ul>

            <p><strong>Cambios en stock:</strong></p>
            <ul>
                <li>Ajuste manual de stock (ingreso/egreso)</li>
                <li>Stock negativo crÃ­tico (< -50 unidades, por ejemplo)</li>
            </ul>

            <p><strong>Cambios en configuraciÃ³n:</strong></p>
            <ul>
                <li>ModificaciÃ³n de listas de precio</li>
                <li>CreaciÃ³n/ediciÃ³n/eliminaciÃ³n de vehÃ­culos</li>
                <li>CreaciÃ³n/ediciÃ³n/eliminaciÃ³n de ciudades</li>
                <li>Cambio de comportamiento de stock</li>
            </ul>

            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>ğŸ’¡ Pendiente definir:</strong> Â¿QuÃ© otros eventos se registrarÃ¡n? (EliminaciÃ³n de pedidos, cambios en cuenta corriente, etc.). Evaluar al prototipar.</p>
            </div>
        </section>

        <!-- SECCIÃ“N 4: REGLAS DE NEGOCIO -->
        <section id="reglas">
            <h2>4. Reglas de Negocio EspecÃ­ficas</h2>

            <h3>4.1 CreaciÃ³n de backups</h3>
            <p><strong>Frecuencia recomendada:</strong></p>
            <ul>
                <li>Backup manual: A demanda del administrador</li>
                <li>Backup automÃ¡tico (opcional): Diario a las 23:00 (pendiente implementar)</li>
            </ul>

            <p><strong>Contenido del backup:</strong></p>
            <ul>
                <li>Dump completo de la base de datos PostgreSQL</li>
                <li>Todas las tablas (pedidos, productos, clientes, configuraciÃ³n, logs, etc.)</li>
                <li>Formato: Archivo .sql con sentencias INSERT</li>
                <li>CompresiÃ³n opcional: .sql.zip para reducir tamaÃ±o</li>
            </ul>

            <p><strong>Almacenamiento:</strong></p>
            <ul>
                <li>Backups se guardan en servidor en carpeta <code>/backups</code></li>
                <li>Administrador puede descargarlos localmente</li>
                <li>RetenciÃ³n: Mantener Ãºltimos 30 backups (eliminar automÃ¡ticamente los mÃ¡s antiguos)</li>
            </ul>

            <h3>4.2 RestauraciÃ³n desde backup</h3>
            <p><strong>Validaciones:</strong></p>
            <ul>
                <li>Solo archivos .sql permitidos</li>
                <li>TamaÃ±o mÃ¡ximo: 100 MB (ajustable segÃºn servidor)</li>
                <li>Advertencia obligatoria antes de confirmar</li>
            </ul>

            <p><strong>Proceso:</strong></p>
            <ol>
                <li>Sistema crea backup automÃ¡tico de seguridad antes de restaurar</li>
                <li>Elimina todas las tablas existentes</li>
                <li>Ejecuta sentencias SQL del archivo subido</li>
                <li>Valida integridad de datos restaurados</li>
                <li>Notifica Ã©xito o error</li>
            </ol>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ PrecauciÃ³n:</strong> Durante la restauraciÃ³n, el sistema debe estar en modo mantenimiento (bloquear accesos de otros usuarios).</p>
            </div>

            <h3>4.3 Registro de logs</h3>
            <p><strong>Eventos que se registran:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Evento</th>
                        <th>InformaciÃ³n registrada</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Login exitoso</strong></td>
                        <td>Usuario, IP, timestamp</td>
                    </tr>
                    <tr>
                        <td><strong>Login fallido</strong></td>
                        <td>Usuario intentado, IP, timestamp</td>
                    </tr>
                    <tr>
                        <td><strong>Logout</strong></td>
                        <td>Usuario, timestamp</td>
                    </tr>
                    <tr>
                        <td><strong>Ajuste stock manual</strong></td>
                        <td>Usuario, producto, cantidad anterior, cantidad nueva, motivo, timestamp</td>
                    </tr>
                    <tr>
                        <td><strong>Cambio configuraciÃ³n</strong></td>
                        <td>Usuario, parÃ¡metro modificado, valor anterior, valor nuevo, timestamp</td>
                    </tr>
                </tbody>
            </table>

            <p><strong>RetenciÃ³n de logs:</strong></p>
            <ul>
                <li>Mantener logs de los Ãºltimos 365 dÃ­as (1 aÃ±o)</li>
                <li>Eliminar automÃ¡ticamente logs mÃ¡s antiguos (opcional: archivar antes de eliminar)</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 5: INTEGRACIÃ“N -->
        <section id="integracion">
            <h2>5. IntegraciÃ³n con Otros MÃ³dulos</h2>

            <h3>5.1 Productos (Logs de stock)</h3>
            <p><strong>RelaciÃ³n:</strong> Cambios en stock se registran en Logs</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Al ajustar stock manualmente â†’ Registro en tabla logs</li>
                <li>Al detectar stock negativo crÃ­tico â†’ Registro en tabla logs</li>
            </ul>

            <h3>5.2 ConfiguraciÃ³n (Logs de cambios)</h3>
            <p><strong>RelaciÃ³n:</strong> Cambios en configuraciÃ³n se registran en Logs</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Al modificar listas de precio â†’ Registro en tabla logs</li>
                <li>Al crear/editar/eliminar vehÃ­culo â†’ Registro en tabla logs</li>
                <li>Al crear/editar/eliminar ciudad â†’ Registro en tabla logs</li>
            </ul>

            <h3>5.3 Sistema de autenticaciÃ³n (Logs de accesos)</h3>
            <p><strong>RelaciÃ³n:</strong> Accesos al sistema se registran en Logs</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Al hacer login exitoso â†’ Registro en tabla logs</li>
                <li>Al intentar login fallido â†’ Registro en tabla logs</li>
                <li>Al hacer logout â†’ Registro en tabla logs</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 6: CASOS DE USO -->
        <section id="casos-uso">
            <h2>6. Casos de Uso</h2>

            <h3>Caso 1: Crear backup manual</h3>
            <p><strong>Contexto:</strong> Administrador quiere crear respaldo antes de hacer cambios importantes</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre Backup y Logs â†’ PestaÃ±a "Backup"</li>
                <li>Click en [Crear respaldo ahora]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Sistema genera dump de base de datos</li>
                <li>âœ… Archivo se descarga: <code>bambu_backup_2024-12-31_14-30-00.sql</code></li>
                <li>âœ… Backup queda registrado en historial con fecha y tamaÃ±o</li>
                <li>âœ… NotificaciÃ³n: "Backup creado correctamente"</li>
            </ul>

            <h3>Caso 2: Restaurar desde backup</h3>
            <p><strong>Contexto:</strong> Se perdieron datos por error, necesitan restaurar backup de ayer</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre Backup y Logs â†’ PestaÃ±a "Backup"</li>
                <li>Click en [Restaurar desde archivo]</li>
                <li>Modal se abre con advertencia</li>
                <li>Selecciona archivo: <code>bambu_backup_2024-12-30_23-00-00.sql</code></li>
                <li>Click [Restaurar]</li>
                <li>Confirma advertencia</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Sistema crea backup automÃ¡tico de seguridad (antes de restaurar)</li>
                <li>âœ… Ejecuta SQL y restaura datos al estado del 30/12</li>
                <li>âœ… NotificaciÃ³n: "Datos restaurados correctamente"</li>
                <li>âœ… Administrador verifica que datos estÃ¡n correctos</li>
            </ul>

            <h3>Caso 3: Consultar logs de accesos</h3>
            <p><strong>Contexto:</strong> Administrador quiere ver quiÃ©n accediÃ³ al sistema en la Ãºltima semana</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre Backup y Logs â†’ PestaÃ±a "Logs"</li>
                <li>Filtros:
                    <ul>
                        <li>Desde: 24/12/2024</li>
                        <li>Hasta: 31/12/2024</li>
                        <li>Tipo: Accesos</li>
                    </ul>
                </li>
                <li>Click [Aplicar filtros]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Tabla muestra solo eventos de tipo "Accesos"</li>
                <li>âœ… Ve login/logout de usuarios en esa semana</li>
                <li>âœ… Puede identificar accesos inusuales o fuera de horario</li>
            </ul>

            <h3>Caso 4: Auditar cambios en stock</h3>
            <p><strong>Contexto:</strong> Stock de un producto cambiÃ³ inesperadamente, necesita investigar</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre Backup y Logs â†’ PestaÃ±a "Logs"</li>
                <li>Filtros:
                    <ul>
                        <li>Tipo: Cambios en stock</li>
                    </ul>
                </li>
                <li>Click [Aplicar filtros]</li>
                <li>Busca en tabla eventos relacionados con ese producto</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Ve registro: "31/12 14:35 | admin@bambu.com | Ajuste manual: Detergente X (+100 un)"</li>
                <li>âœ… Identifica quiÃ©n hizo el cambio y cuÃ¡ndo</li>
                <li>âœ… Puede verificar si fue intencional o error</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 7: FLUJOS DE USUARIO -->
        <section id="flujos">
            <h2>7. Flujos de Usuario</h2>

            <h3>7.1 Flujo: Crear backup</h3>
            <pre><code>Administrador accede a Backup y Logs
        â†“
Selecciona pestaÃ±a "Backup"
        â†“
Click [Crear respaldo ahora]
        â†“
Sistema ejecuta:
â”œâ”€ pg_dump de base de datos PostgreSQL
â”œâ”€ Genera archivo .sql
â””â”€ Guarda en carpeta /backups
        â†“
Archivo se descarga automÃ¡ticamente
        â†“
Backup registrado en historial
        â†“
NotificaciÃ³n: âœ… "Backup creado correctamente"</code></pre>

            <h3>7.2 Flujo: Restaurar desde backup</h3>
            <pre><code>Administrador accede a Backup y Logs
        â†“
Selecciona pestaÃ±a "Backup"
        â†“
Click [Restaurar desde archivo]
        â†“
Modal se abre con advertencia:
âš ï¸ "Esta acciÃ³n sobrescribirÃ¡ todos los datos actuales"
        â†“
Usuario selecciona archivo .sql
        â†“
Click [Restaurar]
        â†“
Sistema ejecuta:
â”œâ”€ Crea backup automÃ¡tico de seguridad
â”œâ”€ Bloquea accesos de otros usuarios
â”œâ”€ Elimina tablas existentes
â”œâ”€ Ejecuta SQL del archivo
â”œâ”€ Valida integridad
â””â”€ Desbloquea accesos
        â†“
NotificaciÃ³n: âœ… "Datos restaurados correctamente"
        â†“
Administrador verifica datos</code></pre>

            <h3>7.3 Flujo: Consultar logs</h3>
            <pre><code>Administrador accede a Backup y Logs
        â†“
Selecciona pestaÃ±a "Logs"
        â†“
Aplica filtros (opcional):
â”œâ”€ Rango de fechas
â”œâ”€ Usuario especÃ­fico
â””â”€ Tipo de evento
        â†“
Click [Aplicar filtros]
        â†“
Sistema ejecuta query a tabla logs
        â†“
Tabla muestra resultados:
â”œâ”€ Ordenados por fecha descendente
â”œâ”€ Con informaciÃ³n completa del evento
â””â”€ Paginados si hay muchos resultados
        â†“
Administrador puede:
â”œâ”€ Reordenar por columna
â””â”€ Exportar logs (opcional)</code></pre>
        </section>

        <!-- SECCIÃ“N 8: NOTAS TÃ‰CNICAS -->
        <section id="notas-tecnicas">
            <h2>8. Notas TÃ©cnicas para Desarrollo</h2>

            <h3>8.1 Estructura de datos (Mock data)</h3>
            <pre><code class="language-javascript">// Backup
const BACKUP_EJEMPLO = {
    id: 1,
    fecha: "2024-12-31 14:30:00",
    tamaÃ±o_bytes: 2621440, // 2.5 MB
    archivo_path: "/backups/bambu_backup_2024-12-31_14-30-00.sql",
    tipo: "MANUAL", // "MANUAL" | "AUTOMATICO"
    created_at: "2024-12-31 14:30:00"
};

// Log de evento
const LOG_EJEMPLO = {
    id: 1,
    fecha: "2024-12-31 14:35:00",
    usuario_id: 1,
    usuario_email: "admin@bambu.com",
    tipo: "STOCK", // "ACCESO" | "STOCK" | "CONFIGURACION"
    descripcion: "Ajuste manual: Detergente X (+100 un)",
    ip_address: "192.168.1.100",
    metadata: { producto_id: 1, cantidad_anterior: 50, cantidad_nueva: 150 }
};
</code></pre>

            <h3>8.2 Consideraciones de implementaciÃ³n</h3>
            <ul>
                <li>âš ï¸ <strong>Backup automÃ¡tico:</strong> Usar cron job o task scheduler (Laravel: <code>Schedule::command('backup:run')->daily()</code>)</li>
                <li>âš ï¸ <strong>RestauraciÃ³n:</strong> Bloquear sistema durante proceso (modo mantenimiento)</li>
                <li>âš ï¸ <strong>Seguridad:</strong> Solo administrador puede acceder a este mÃ³dulo (middleware auth + admin check)</li>
                <li>âš ï¸ <strong>TamaÃ±o archivos:</strong> Configurar upload_max_filesize en PHP para archivos grandes</li>
                <li>ğŸ’¡ <strong>CompresiÃ³n:</strong> Comprimir backups con gzip (.sql.gz) para reducir espacio</li>
                <li>ğŸ’¡ <strong>Logs:</strong> Usar tabla separada para logs (no mezclar con otras tablas)</li>
                <li>ğŸ’¡ <strong>Performance:</strong> Ãndice en tabla logs (fecha, usuario_id, tipo)</li>
            </ul>

            <h3>8.3 Comandos Ãºtiles</h3>
            <pre><code class="language-bash"># Crear backup de PostgreSQL
pg_dump -U postgres -h localhost bambu_crm > backup.sql

# Restaurar backup
psql -U postgres -h localhost bambu_crm < backup.sql

# Comprimir backup
gzip backup.sql

# Descomprimir backup
gunzip backup.sql.gz</code></pre>

            <h3>8.4 Estructura de base de datos</h3>
            <pre><code class="language-sql">-- Tabla de backups
CREATE TABLE backups (
    id SERIAL PRIMARY KEY,
    fecha TIMESTAMP NOT NULL,
    tamaÃ±o_bytes BIGINT NOT NULL,
    archivo_path VARCHAR(500) NOT NULL,
    tipo VARCHAR(20) NOT NULL, -- MANUAL | AUTOMATICO
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Tabla de logs
CREATE TABLE logs (
    id SERIAL PRIMARY KEY,
    fecha TIMESTAMP NOT NULL,
    usuario_id INT REFERENCES usuarios(id) ON DELETE SET NULL,
    tipo VARCHAR(50) NOT NULL, -- ACCESO | STOCK | CONFIGURACION
    descripcion TEXT NOT NULL,
    ip_address VARCHAR(50),
    metadata JSONB, -- Datos adicionales del evento
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndices para performance
CREATE INDEX idx_logs_fecha ON logs(fecha DESC);
CREATE INDEX idx_logs_usuario ON logs(usuario_id);
CREATE INDEX idx_logs_tipo ON logs(tipo);</code></pre>
        </section>

        <!-- PIE DE PÃGINA -->
        <footer>
            <p>Bambu CRM V2 - PRD TÃ©cnico | Ãšltima actualizaciÃ³n: 31 Diciembre 2024</p>
            <p><a href="index.html">â† Volver al PRD General</a></p>
        </footer>
    </main>

    <!-- SCRIPT PARA TOC AUTO -->
    <script>
        // Auto-generar tabla de contenidos desde los h2
        const toc = document.getElementById('toc');
        const h2s = document.querySelectorAll('main h2');
        h2s.forEach(h2 => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + h2.parentElement.id;
            a.textContent = h2.textContent;
            a.className = 'nav-link';
            li.appendChild(a);
            toc.appendChild(li);
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-toggle')?.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });
    </script>
</body>

</html>
