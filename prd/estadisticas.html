<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - EstadÃ­sticas | Bambu CRM V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>

    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜° MenÃº</button>

    <nav id="sidebar">
        <div class="logo">
            <span>â—†</span> Bambu CRM v2
        </div>

        <div class="nav-group">
            <div class="nav-header">NavegaciÃ³n</div>
            <a href="index.html" class="nav-link">â† PRD General</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">Otros MÃ³dulos</div>
            <a href="ventas.html" class="nav-link">Ventas</a>
            <a href="productos.html" class="nav-link">Productos</a>
            <a href="configuracion.html" class="nav-link">ConfiguraciÃ³n</a>
            <a href="estadisticas.html" class="nav-link active">EstadÃ­sticas</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">En esta pÃ¡gina</div>
            <ul id="toc" style="list-style: none; padding: 0; margin: 0;">
                <!-- Auto-generado desde los h2 -->
            </ul>
        </div>
    </nav>

    <main>
        <header>
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase;">
                QuÃ­mica Bambu S.R.L.
            </div>
            <h1>PRD: EstadÃ­sticas de Ventas <br><span style="font-weight: 300; font-size: 1.5rem; color: var(--text-secondary);">AnÃ¡lisis de ventas por producto</span></h1>

            <table>
                <tr>
                    <td style="width: 150px;"><strong>VersiÃ³n</strong></td>
                    <td>2.0</td>
                </tr>
                <tr>
                    <td><strong>Fecha</strong></td>
                    <td>31 Diciembre 2024</td>
                </tr>
                <tr>
                    <td><strong>Estado</strong></td>
                    <td>âœ… Prototipado y validado (Enero 2026)</td>
                </tr>
            </table>

            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>Nota:</strong> Este PRD describe funcionalidades y reglas de negocio. Para referencia visual, ver el <a href="../prototipos/estadisticas.html">prototipo HTML</a>.</p>
            </div>
        </header>

        <!-- SECCIÃ“N 1: CONTEXTO Y OBJETIVO -->
        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>1.1 PropÃ³sito del mÃ³dulo</h3>
            <p>El mÃ³dulo <strong>EstadÃ­sticas de Ventas por Producto</strong> permite analizar el desempeÃ±o comercial de cada producto en perÃ­odos de tiempo especÃ­ficos. Provee mÃ©tricas clave para decisiones de inventario, producciÃ³n y estrategia comercial.</p>

            <h3>1.2 Problema que resuelve</h3>
            <ul>
                <li>Identificar productos mÃ¡s vendidos vs menos vendidos</li>
                <li>Analizar tendencias de ventas por perÃ­odo</li>
                <li>Tomar decisiones de stock basadas en datos</li>
                <li>Detectar productos de baja rotaciÃ³n</li>
                <li>Generar reportes de ventas por producto</li>
            </ul>

            <h3>1.3 Usuarios principales</h3>
            <ul>
                <li><strong>Administrador:</strong> Acceso completo a estadÃ­sticas y reportes</li>
                <li><strong>Vendedor:</strong> SIN ACCESO (mÃ³dulo exclusivo admin)</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 2: FUNCIONALIDAD PRINCIPAL -->
        <section id="funcionalidad">
            <h2>2. Funcionalidad Principal</h2>

            <h3>2.1 DescripciÃ³n general</h3>
            <p>El mÃ³dulo muestra una tabla con todos los productos del catÃ¡logo y sus mÃ©tricas de venta en un perÃ­odo seleccionado. Permite filtrar por fecha, ordenar por cantidad vendida o monto total, y exportar resultados a Excel.</p>

            <h3>2.2 CaracterÃ­sticas clave</h3>
            <ul>
                <li>âœ… Selector de perÃ­odo (desde-hasta)</li>
                <li>âœ… Cards resumen: productos vendidos, unidades, monto total, pedidos</li>
                <li>âœ… Tabla de productos con mÃ©tricas de venta</li>
                <li>âœ… Ordenamiento por cantidad vendida o monto total</li>
                <li>âœ… GrÃ¡fico Top 10 productos (Chart.js) con toggle cantidad/monto</li>
                <li>âœ… ExportaciÃ³n CSV con resumen detallado</li>
                <li>âœ… Filtros adicionales: Por proveedor, bÃºsqueda por nombre</li>
            </ul>

            <h3>2.3 Flujo de trabajo tÃ­pico</h3>
            <pre><code>Administrador accede a EstadÃ­sticas
        â†“
Selecciona perÃ­odo (ej: Diciembre 2024)
        â†“
Sistema calcula mÃ©tricas por producto:
â”œâ”€ Cantidad vendida
â”œâ”€ Monto total
â””â”€ ParticipaciÃ³n en ventas (%)
        â†“
Tabla muestra productos ordenados por cantidad vendida
        â†“
Administrador puede:
â”œâ”€ Reordenar por monto total
â”œâ”€ Filtrar por proveedor
â”œâ”€ Exportar Excel
â””â”€ Ver grÃ¡fico de tendencia</code></pre>
        </section>

        <!-- SECCIÃ“N 3: INTERFAZ DE USUARIO -->
        <section id="interfaz">
            <h2>3. Interfaz de Usuario</h2>

            <h3>3.1 Layout general</h3>
            <p><strong>Vista principal:</strong> Filtros superiores + Tabla de resultados + BotÃ³n exportar</p>

            <p><strong>Estructura:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ESTADÃSTICAS DE VENTAS POR PRODUCTO                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  PerÃ­odo:  [Desde: 01/12/2024] [Hasta: 31/12/2024]      â”‚
â”‚  Filtros:  [Proveedor â–¼]  [Buscar producto...]          â”‚
â”‚            [Aplicar filtros]  [Exportar Excel]           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Producto          â”‚ Cant. vendida â”‚ Monto total â”‚ %    â”‚
â”‚  Detergente X      â”‚ 350 un        â”‚ $1.575.000  â”‚ 25%  â”‚
â”‚  Lavandina Y       â”‚ 280 un        â”‚ $896.000    â”‚ 14%  â”‚
â”‚  Cloro Z           â”‚ 150 un        â”‚ $675.000    â”‚ 11%  â”‚
â”‚  ...               â”‚               â”‚             â”‚      â”‚
â”‚  TOTAL             â”‚ 1.200 un      â”‚ $6.300.000  â”‚ 100% â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>3.2 Filtros superiores</h3>
            <table>
                <thead>
                    <tr>
                        <th>Filtro</th>
                        <th>Tipo</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Desde (fecha)</strong></td>
                        <td>Date picker</td>
                        <td>Fecha inicial del perÃ­odo (obligatorio)</td>
                    </tr>
                    <tr>
                        <td><strong>Hasta (fecha)</strong></td>
                        <td>Date picker</td>
                        <td>Fecha final del perÃ­odo (obligatorio)</td>
                    </tr>
                    <tr>
                        <td><strong>Proveedor</strong></td>
                        <td>Dropdown</td>
                        <td>Filtrar solo productos de un proveedor especÃ­fico (opcional)</td>
                    </tr>
                    <tr>
                        <td><strong>Buscar producto</strong></td>
                        <td>Input text</td>
                        <td>Buscar producto por nombre (opcional)</td>
                    </tr>
                </tbody>
            </table>

            <h3>3.3 Tabla de resultados</h3>
            <p><strong>Columnas:</strong></p>
            <ul>
                <li><strong>Producto:</strong> Nombre del producto</li>
                <li><strong>Cantidad vendida:</strong> Total de unidades vendidas en el perÃ­odo (clickeable para ordenar)</li>
                <li><strong>Monto total:</strong> Suma de ventas en pesos (clickeable para ordenar)</li>
                <li><strong>% ParticipaciÃ³n:</strong> Porcentaje del total de ventas</li>
                <li><strong>Acciones:</strong> [Ver detalle] (abre modal con ventas individuales)</li>
            </ul>

            <p><strong>Fila TOTAL:</strong></p>
            <ul>
                <li>Al final de la tabla</li>
                <li>Suma total de cantidades, montos y 100%</li>
                <li>Fondo destacado para diferenciarlo</li>
            </ul>

            <p><strong>Ordenamiento:</strong></p>
            <ul>
                <li>Default: Por cantidad vendida (descendente)</li>
                <li>Clickeable en headers: Permite ordenar por cualquier columna</li>
            </ul>

            <h3>3.4 GrÃ¡fico Top 10 Productos</h3>
            <p><strong>Tipo:</strong> GrÃ¡fico de barras verticales (Chart.js)</p>

            <p><strong>Contenido:</strong></p>
            <ul>
                <li>Eje X: Productos (top 10 mÃ¡s vendidos, nombres truncados a 20 chars)</li>
                <li>Eje Y: Cantidad vendida o Monto total (segÃºn toggle)</li>
                <li>Toggle botones: "Cantidad" / "Monto" para cambiar visualizaciÃ³n</li>
                <li>Tooltips formateados segÃºn tipo (unidades vs $)</li>
                <li>Dark mode compatible (colores adaptan al tema)</li>
            </ul>

            <h3>3.5 Modal: Ver detalle de producto</h3>
            <p><strong>Acceso:</strong> Click en [Ver detalle] de un producto en la tabla</p>

            <p><strong>Contenido:</strong></p>
            <ul>
                <li>Nombre del producto (header)</li>
                <li>PerÃ­odo seleccionado</li>
                <li>Tabla con pedidos individuales:
                    <ul>
                        <li>Fecha del pedido</li>
                        <li>Pedido # (clickeable â†’ abre pedido en Ventas)</li>
                        <li>Cliente</li>
                        <li>Cantidad vendida</li>
                        <li>Precio unitario</li>
                        <li>Subtotal</li>
                    </ul>
                </li>
                <li>Total al final de la tabla</li>
            </ul>

            <h3>3.6 Exportar Excel</h3>
            <p><strong>UbicaciÃ³n:</strong> BotÃ³n [Exportar Excel] en header superior</p>

            <p><strong>Archivo generado:</strong></p>
            <ul>
                <li>Nombre: <code>estadisticas_ventas_YYYY-MM-DD.xlsx</code></li>
                <li>Columnas: Producto | Cantidad vendida | Monto total | % ParticipaciÃ³n</li>
                <li>Fila TOTAL al final</li>
                <li>Filtros aplicados se incluyen como informaciÃ³n en el archivo (perÃ­odo, proveedor si aplica)</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 4: REGLAS DE NEGOCIO -->
        <section id="reglas">
            <h2>4. Reglas de Negocio EspecÃ­ficas</h2>

            <h3>4.1 Validaciones</h3>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>ValidaciÃ³n</th>
                        <th>Mensaje de error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Desde (fecha)</strong></td>
                        <td>No puede ser mayor que "Hasta"</td>
                        <td>"La fecha inicial no puede ser posterior a la fecha final"</td>
                    </tr>
                    <tr>
                        <td><strong>Hasta (fecha)</strong></td>
                        <td>No puede ser anterior a "Desde"</td>
                        <td>"La fecha final no puede ser anterior a la fecha inicial"</td>
                    </tr>
                    <tr>
                        <td><strong>PerÃ­odo mÃ¡ximo</strong></td>
                        <td>No mÃ¡s de 1 aÃ±o (opcional, por performance)</td>
                        <td>"El perÃ­odo mÃ¡ximo es de 1 aÃ±o"</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.2 CÃ¡lculo de mÃ©tricas</h3>
            <p><strong>Cantidad vendida:</strong></p>
            <ul>
                <li>Suma de cantidades de ese producto en TODOS los pedidos confirmados (estado != borrador)</li>
                <li>Incluye pedidos entregados y en trÃ¡nsito</li>
                <li>NO incluye borradores (nunca confirmados)</li>
            </ul>

            <p><strong>Monto total:</strong></p>
            <ul>
                <li>Suma de (cantidad * precio_unitario) en cada pedido</li>
                <li>Usa el precio al momento de la venta (histÃ³rico)</li>
                <li>Incluye descuentos aplicados en ese momento</li>
            </ul>

            <p><strong>% ParticipaciÃ³n:</strong></p>
            <ul>
                <li>FÃ³rmula: (Monto total del producto / Monto total de todos) * 100</li>
                <li>Permite identificar productos que representan mayor porcentaje de ventas</li>
            </ul>

            <h3>4.3 Productos sin ventas</h3>
            <p><strong>Comportamiento:</strong></p>
            <ul>
                <li>Por defecto, NO se muestran productos con 0 ventas en el perÃ­odo</li>
                <li>Toggle opcional: "Mostrar productos sin ventas" (marca productos inactivos)</li>
                <li>Si se activa, productos con 0 ventas aparecen al final con cantidad = 0, monto = $0</li>
            </ul>

            <h3>4.4 Pedidos incluidos en estadÃ­sticas</h3>
            <p><strong>Regla:</strong> Solo se cuentan pedidos con estado != "borrador"</p>

            <p><strong>Estados incluidos:</strong></p>
            <ul>
                <li>âœ… Pendiente</li>
                <li>âœ… Asignado</li>
                <li>âœ… En trÃ¡nsito</li>
                <li>âœ… Entregado</li>
            </ul>

            <p><strong>Estados NO incluidos:</strong></p>
            <ul>
                <li>âŒ Borrador (nunca confirmado)</li>
            </ul>
            <p><em>Nota: El estado "Cancelado" no existe actualmente en el sistema.</em></p>
        </section>

        <!-- SECCIÃ“N 5: INTEGRACIÃ“N -->
        <section id="integracion">
            <h2>5. IntegraciÃ³n con Otros MÃ³dulos</h2>

            <h3>5.1 Ventas</h3>
            <p><strong>RelaciÃ³n:</strong> EstadÃ­sticas consume datos de pedidos del mÃ³dulo Ventas</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Query a tabla de pedidos filtrando por rango de fechas</li>
                <li>Click en pedido individual en modal "Ver detalle" abre ese pedido en Ventas</li>
                <li>Los cambios en pedidos (ediciones, eliminaciones) se reflejan inmediatamente en estadÃ­sticas</li>
            </ul>

            <h3>5.2 Productos</h3>
            <p><strong>RelaciÃ³n:</strong> EstadÃ­sticas muestra productos del catÃ¡logo</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Lista de productos se obtiene de la tabla de productos</li>
                <li>Productos eliminados del catÃ¡logo siguen apareciendo en estadÃ­sticas si tuvieron ventas histÃ³ricas</li>
                <li>Filtro por proveedor consume tabla de proveedores</li>
            </ul>

            <h3>5.3 Dashboard (opcional)</h3>
            <p><strong>RelaciÃ³n:</strong> Dashboard puede mostrar widget con top 5 productos mÃ¡s vendidos</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Widget en Dashboard usa misma query que EstadÃ­sticas pero limitado a top 5</li>
                <li>Click en widget redirige a EstadÃ­sticas con perÃ­odo del mes actual</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 6: CASOS DE USO -->
        <section id="casos-uso">
            <h2>6. Casos de Uso</h2>

            <h3>Caso 1: Consultar ventas del mes actual</h3>
            <p><strong>Contexto:</strong> Administrador quiere saber quÃ© productos se vendieron en Diciembre 2024</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre mÃ³dulo EstadÃ­sticas</li>
                <li>Selecciona perÃ­odo:
                    <ul>
                        <li>Desde: 01/12/2024</li>
                        <li>Hasta: 31/12/2024</li>
                    </ul>
                </li>
                <li>Click [Aplicar filtros]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Tabla muestra todos los productos con ventas en Diciembre</li>
                <li>âœ… Ordenados por cantidad vendida (descendente)</li>
                <li>âœ… Fila TOTAL al final con suma de cantidades y montos</li>
            </ul>

            <h3>Caso 2: Identificar top 5 productos mÃ¡s vendidos</h3>
            <p><strong>Contexto:</strong> Administrador necesita saber cuÃ¡les son los productos lÃ­deres en el aÃ±o</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre EstadÃ­sticas</li>
                <li>Selecciona perÃ­odo: 01/01/2024 â†’ 31/12/2024</li>
                <li>Click [Aplicar filtros]</li>
                <li>Tabla ya ordenada por cantidad vendida (descendente)</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Los primeros 5 productos en la tabla son los mÃ¡s vendidos del aÃ±o</li>
                <li>âœ… Puede ver cantidad exacta y participaciÃ³n %</li>
            </ul>

            <h3>Caso 3: Filtrar ventas de un proveedor especÃ­fico</h3>
            <p><strong>Contexto:</strong> Administrador quiere analizar solo productos del "Proveedor A"</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre EstadÃ­sticas</li>
                <li>Selecciona perÃ­odo (ej: Diciembre 2024)</li>
                <li>Selecciona filtro: Proveedor â†’ "Proveedor A"</li>
                <li>Click [Aplicar filtros]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Tabla muestra SOLO productos del "Proveedor A"</li>
                <li>âœ… % ParticipaciÃ³n se recalcula en base a ese subconjunto</li>
                <li>âœ… Fila TOTAL suma solo productos filtrados</li>
            </ul>

            <h3>Caso 4: Ver detalle de ventas de un producto</h3>
            <p><strong>Contexto:</strong> Administrador quiere ver cuÃ¡ndo y a quiÃ©nes se vendiÃ³ "Detergente X"</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador aplica filtros de perÃ­odo</li>
                <li>Busca "Detergente X" en la tabla</li>
                <li>Click en [Ver detalle]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Modal muestra tabla con pedidos individuales:
                    <ul>
                        <li>Pedido #152 | 25/12/2024 | Cliente "Av. Argentina 456" | 10 un | $4.500 | $45.000</li>
                        <li>Pedido #165 | 28/12/2024 | Cliente "Calle Falsa 123" | 5 un | $4.500 | $22.500</li>
                        <li>... (resto de pedidos)</li>
                        <li><strong>TOTAL: 350 un | $1.575.000</strong></li>
                    </ul>
                </li>
                <li>âœ… Puede hacer click en pedido # para abrirlo en Ventas</li>
            </ul>

            <h3>Caso 5: Exportar estadÃ­sticas a Excel</h3>
            <p><strong>Contexto:</strong> Administrador necesita enviar reporte de ventas al contador</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador aplica filtros de perÃ­odo y proveedor (si aplica)</li>
                <li>Click en [Exportar Excel]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Descarga archivo <code>estadisticas_ventas_2024-12-31.xlsx</code></li>
                <li>âœ… Contiene:
                    <ul>
                        <li>Encabezado: "EstadÃ­sticas de Ventas | PerÃ­odo: 01/12/2024 - 31/12/2024"</li>
                        <li>Tabla: Producto | Cantidad | Monto | %</li>
                        <li>Fila TOTAL al final</li>
                    </ul>
                </li>
            </ul>

            <h3>Caso 6: Detectar productos de baja rotaciÃ³n</h3>
            <p><strong>Contexto:</strong> Administrador quiere identificar productos que casi no se venden</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Administrador abre EstadÃ­sticas</li>
                <li>Selecciona perÃ­odo amplio (ej: Ãºltimo trimestre)</li>
                <li>Click [Aplicar filtros]</li>
                <li>Click en columna "Cantidad vendida" para ordenar ascendente</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Productos con menos ventas aparecen primero</li>
                <li>âœ… Puede detectar productos con 0, 1 o 2 ventas en 3 meses</li>
                <li>âœ… Toma decisiones: Descontinuar, hacer promociÃ³n, ajustar stock</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 7: FLUJOS DE USUARIO -->
        <section id="flujos">
            <h2>7. Flujos de Usuario</h2>

            <h3>7.1 Flujo principal: Consultar estadÃ­sticas</h3>
            <pre><code>Administrador accede a EstadÃ­sticas
        â†“
Selecciona perÃ­odo (desde-hasta)
        â†“
(Opcional) Aplica filtros:
â”œâ”€ Proveedor
â””â”€ Buscar producto
        â†“
Click [Aplicar filtros]
        â†“
Sistema calcula mÃ©tricas:
â”œâ”€ Query a tabla pedidos (fecha BETWEEN desde AND hasta)
â”œâ”€ Agrupa por producto_id
â”œâ”€ Suma cantidad y monto por producto
â””â”€ Calcula % participaciÃ³n
        â†“
Tabla muestra resultados ordenados por cantidad vendida
        â†“
Administrador puede:
â”œâ”€ Reordenar por columna (click en header)
â”œâ”€ Ver detalle de producto (click [Ver detalle])
â”œâ”€ Exportar Excel
â””â”€ (Opcional) Ver grÃ¡fico de tendencia</code></pre>

            <h3>7.2 Flujo: Ver detalle de producto</h3>
            <pre><code>Administrador en tabla de estadÃ­sticas
        â†“
Click [Ver detalle] en producto especÃ­fico
        â†“
Modal se abre mostrando:
â”œâ”€ Header: Nombre del producto + perÃ­odo
â”œâ”€ Tabla de pedidos individuales:
â”‚   â”œâ”€ Fecha | Pedido # | Cliente
â”‚   â”œâ”€ Cantidad | Precio unitario | Subtotal
â”‚   â””â”€ (Ordenado por fecha descendente)
â””â”€ Fila TOTAL al final
        â†“
Administrador puede:
â”œâ”€ Click en Pedido # â†’ Redirige a Ventas (abre pedido)
â””â”€ [Cerrar modal]</code></pre>

            <h3>7.3 Flujo: Exportar Excel</h3>
            <pre><code>Administrador en EstadÃ­sticas con filtros aplicados
        â†“
Click [Exportar Excel]
        â†“
Sistema genera archivo:
â”œâ”€ Encabezado con perÃ­odo y filtros aplicados
â”œâ”€ Tabla con columnas: Producto | Cantidad | Monto | %
â”œâ”€ Fila TOTAL al final
â””â”€ Formato: estadisticas_ventas_YYYY-MM-DD.xlsx
        â†“
Archivo se descarga automÃ¡ticamente
        â†“
NotificaciÃ³n: âœ… "Reporte exportado correctamente"</code></pre>
        </section>

        <!-- SECCIÃ“N 8: NOTAS TÃ‰CNICAS -->
        <section id="notas-tecnicas">
            <h2>8. Notas TÃ©cnicas para Desarrollo</h2>

            <h3>8.1 Estructura de datos (Mock data)</h3>
            <pre><code class="language-javascript">// EstadÃ­stica de producto
const ESTADISTICA_PRODUCTO = {
    producto_id: 1,
    producto_nombre: "Detergente Concentrado 5L",
    cantidad_vendida: 350, // Suma de cantidades en pedidos
    monto_total: 1575000, // Suma de subtotales en pedidos
    participacion_porcentaje: 25.0 // (monto_total / monto_total_todos) * 100
};

// Detalle de venta individual (para modal "Ver detalle")
const DETALLE_VENTA = {
    pedido_id: 152,
    fecha: "2024-12-25",
    cliente_direccion: "Av. Argentina 456",
    cantidad: 10,
    precio_unitario: 4500,
    subtotal: 45000
};
</code></pre>

            <h3>8.2 Consideraciones de implementaciÃ³n</h3>
            <ul>
                <li>âš ï¸ <strong>Performance:</strong> Query agregada puede ser pesada en perÃ­odos largos â†’ Usar Ã­ndices en tabla pedidos (fecha, producto_id)</li>
                <li>âš ï¸ <strong>CachÃ©:</strong> Considerar cachear resultados de perÃ­odos cerrados (ej: meses completos) para mejorar velocidad</li>
                <li>âš ï¸ <strong>PaginaciÃ³n:</strong> Si catÃ¡logo es muy grande (100+ productos), paginar tabla de resultados</li>
                <li>ğŸ’¡ <strong>GrÃ¡ficos:</strong> Evaluar librerÃ­a Chart.js (vanilla JS) para implementar grÃ¡ficos de tendencia</li>
                <li>ğŸ’¡ <strong>ExportaciÃ³n Excel:</strong> Usar librerÃ­a SheetJS (xlsx) para generar archivos</li>
            </ul>

            <h3>8.3 Queries SQL Ãºtiles</h3>
            <pre><code class="language-sql">-- EstadÃ­sticas de ventas por producto en un perÃ­odo
SELECT
    p.id as producto_id,
    p.nombre as producto_nombre,
    SUM(pp.cantidad) as cantidad_vendida,
    SUM(pp.cantidad * pp.precio_unitario) as monto_total,
    (SUM(pp.cantidad * pp.precio_unitario) / (
        SELECT SUM(pp2.cantidad * pp2.precio_unitario)
        FROM pedidos_productos pp2
        JOIN pedidos ped2 ON pp2.pedido_id = ped2.id
        WHERE ped2.fecha BETWEEN ? AND ?
        AND ped2.estado != 'borrador'
    ) * 100) as participacion_porcentaje
FROM productos p
LEFT JOIN pedidos_productos pp ON p.id = pp.producto_id
LEFT JOIN pedidos ped ON pp.pedido_id = ped.id
WHERE ped.fecha BETWEEN ? AND ?
AND ped.estado != 'borrador'
GROUP BY p.id, p.nombre
HAVING SUM(pp.cantidad) > 0
ORDER BY cantidad_vendida DESC;

-- Detalle de ventas de un producto especÃ­fico
SELECT
    ped.id as pedido_id,
    ped.fecha,
    c.direccion as cliente_direccion,
    pp.cantidad,
    pp.precio_unitario,
    (pp.cantidad * pp.precio_unitario) as subtotal
FROM pedidos_productos pp
JOIN pedidos ped ON pp.pedido_id = ped.id
LEFT JOIN clientes c ON ped.cliente_id = c.id
WHERE pp.producto_id = ?
AND ped.fecha BETWEEN ? AND ?
AND ped.estado != 'borrador'
ORDER BY ped.fecha DESC;</code></pre>

            <h3>8.4 CÃ¡lculo de porcentaje de participaciÃ³n</h3>
            <pre><code class="language-javascript">// FunciÃ³n para calcular participaciÃ³n de cada producto
function calcularParticipacion(productos, montoTotalGeneral) {
    return productos.map(producto => ({
        ...producto,
        participacion_porcentaje: (producto.monto_total / montoTotalGeneral) * 100
    }));
}

// FunciÃ³n para formatear resultados de estadÃ­sticas
function formatearEstadisticas(productos) {
    const montoTotalGeneral = productos.reduce((sum, p) => sum + p.monto_total, 0);
    const cantidadTotalGeneral = productos.reduce((sum, p) => sum + p.cantidad_vendida, 0);

    const productosConParticipacion = calcularParticipacion(productos, montoTotalGeneral);

    return {
        productos: productosConParticipacion,
        totales: {
            cantidad_vendida: cantidadTotalGeneral,
            monto_total: montoTotalGeneral,
            participacion_porcentaje: 100
        }
    };
}
</code></pre>
        </section>

        <!-- PIE DE PÃGINA -->
        <footer>
            <p>Bambu CRM V2 - PRD TÃ©cnico | Ãšltima actualizaciÃ³n: 31 Diciembre 2024</p>
            <p><a href="index.html">â† Volver al PRD General</a></p>
        </footer>
    </main>

    <!-- SCRIPT PARA TOC AUTO -->
    <script>
        // Auto-generar tabla de contenidos desde los h2
        const toc = document.getElementById('toc');
        const h2s = document.querySelectorAll('main h2');
        h2s.forEach(h2 => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + h2.parentElement.id;
            a.textContent = h2.textContent;
            a.className = 'nav-link';
            li.appendChild(a);
            toc.appendChild(li);
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-toggle')?.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });
    </script>
</body>

</html>
