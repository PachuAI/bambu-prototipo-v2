<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRD - Clientes | Bambu CRM V2</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/styles.css">
</head>

<body>

    <button class="mobile-menu-toggle" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜° MenÃº</button>

    <nav id="sidebar">
        <div class="logo">
            <span>â—†</span> Bambu CRM v2
        </div>

        <div class="nav-group">
            <div class="nav-header">NavegaciÃ³n</div>
            <a href="index.html" class="nav-link">â† PRD General</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">Otros MÃ³dulos</div>
            <a href="cotizador-especificacion.html" class="nav-link">Cotizador</a>
            <a href="ventas.html" class="nav-link">Ventas</a>
            <a href="cuenta-corriente.html" class="nav-link">Cuenta Corriente</a>
            <a href="clientes.html" class="nav-link active">Clientes</a>
            <a href="productos.html" class="nav-link">Productos</a>
        </div>

        <div class="nav-group">
            <div class="nav-header">En esta pÃ¡gina</div>
            <ul id="toc" style="list-style: none; padding: 0; margin: 0;">
                <!-- Auto-generado desde los h2 -->
            </ul>
        </div>
    </nav>

    <main>
        <header>
            <div style="margin-bottom: 1rem; font-size: 0.9rem; color: var(--text-secondary); text-transform: uppercase;">
                QuÃ­mica Bambu S.R.L.
            </div>
            <h1>PRD: Clientes <br><span style="font-weight: 300; font-size: 1.5rem; color: var(--text-secondary);">GestiÃ³n de la base de clientes</span></h1>

            <table>
                <tr>
                    <td style="width: 150px;"><strong>VersiÃ³n</strong></td>
                    <td>2.0</td>
                </tr>
                <tr>
                    <td><strong>Fecha</strong></td>
                    <td>31 Diciembre 2024</td>
                </tr>
                <tr>
                    <td><strong>Estado</strong></td>
                    <td>âœ… Prototipado y validado (Enero 2026)</td>
                </tr>
            </table>
        </header>

        <!-- SECCIÃ“N 1: CONTEXTO Y OBJETIVO -->
        <section id="contexto">
            <h2>1. Contexto y Objetivo</h2>

            <h3>1.1 PropÃ³sito del mÃ³dulo</h3>
            <p>El mÃ³dulo <strong>Clientes</strong> gestiona la base de datos de todos los clientes de QuÃ­mica Bambu. Centraliza informaciÃ³n de contacto, configuraciÃ³n comercial (lista de precios, descuentos) y acceso a cuenta corriente y historial de pedidos.</p>

            <h3>1.2 Problema que resuelve</h3>
            <ul>
                <li>GestiÃ³n centralizada de datos de clientes</li>
                <li>ConfiguraciÃ³n de descuentos fijos por cliente (L2/L3)</li>
                <li>Acceso rÃ¡pido a cuenta corriente y saldo</li>
                <li>Historial completo de pedidos por cliente</li>
                <li>BÃºsqueda y filtrado eficiente de clientes</li>
            </ul>

            <h3>1.3 Usuarios principales</h3>
            <ul>
                <li><strong>Administrador:</strong> CRUD completo, configuraciÃ³n de descuentos, acceso total a cuenta corriente</li>
                <li><strong>Vendedor:</strong> Solo lectura + selecciÃ³n de clientes en cotizador</li>
            </ul>

            <h3>1.4 SimplificaciÃ³n v1 â†’ v2</h3>
            <table>
                <thead>
                    <tr>
                        <th>Aspecto</th>
                        <th>v1</th>
                        <th>v2</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>IdentificaciÃ³n principal</td>
                        <td>CUIT + RazÃ³n Social</td>
                        <td>DirecciÃ³n (mÃ¡s natural para el negocio)</td>
                    </tr>
                    <tr>
                        <td>Descuento fijo</td>
                        <td>Campo porcentaje personalizado</td>
                        <td>Radio buttons: Sin descuento / L2 (6.25%) / L3 (10%)</td>
                    </tr>
                    <tr>
                        <td>Cuenta Corriente</td>
                        <td>PestaÃ±a dentro de Cliente</td>
                        <td>PestaÃ±a dentro de Cliente + MÃ³dulo independiente (sincronizados)</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- SECCIÃ“N 2: FUNCIONALIDAD PRINCIPAL -->
        <section id="funcionalidad">
            <h2>2. Funcionalidad Principal</h2>

            <h3>2.1 DescripciÃ³n general</h3>
            <p>El mÃ³dulo Clientes permite gestionar toda la informaciÃ³n comercial de cada cliente. Cada cliente almacena:</p>
            <ul>
                <li>Datos de contacto: DirecciÃ³n (principal), telÃ©fono, email, ciudad</li>
                <li>ConfiguraciÃ³n comercial: Descuento fijo, lista de precios predeterminada</li>
                <li>Datos financieros: Saldo en cuenta corriente</li>
                <li>Historial: Pedidos realizados, movimientos de cuenta corriente</li>
            </ul>

            <p>La direcciÃ³n es el identificador natural del cliente (no se usa CUIT ni razÃ³n social).</p>

            <h3>2.2 CaracterÃ­sticas clave</h3>
            <ul>
                <li>âœ… CRUD completo de clientes (crear, leer, editar, eliminar)</li>
                <li>âœ… DirecciÃ³n como identificador principal</li>
                <li>âœ… Descuento fijo configurable (Sin descuento / L2 / L3)</li>
                <li>âœ… BÃºsqueda por direcciÃ³n, telÃ©fono o ciudad</li>
                <li>âœ… Filtrado por ciudad, descuento, saldo</li>
                <li>âœ… Vista detallada con 2 pestaÃ±as: InformaciÃ³n + Cuenta Corriente</li>
                <li>âœ… Historial de pedidos del cliente</li>
                <li>âœ… Acceso directo a cuenta corriente desde tabla</li>
                <li>âœ… Indicador visual de saldo (verde/rojo)</li>
                <li>âœ… ExportaciÃ³n de listado de clientes</li>
            </ul>

            <h3>2.3 Flujo de trabajo tÃ­pico</h3>
            <pre><code>Usuario accede a Clientes
        â†“
Visualiza tabla con todos los clientes
        â†“
Puede filtrar por: Ciudad | Descuento | Saldo positivo/negativo
        â†“
Acciones disponibles:
â”œâ”€ [+ Crear cliente]
â”œâ”€ BÃºsqueda por direcciÃ³n/telÃ©fono/ciudad
â”œâ”€ Click en cliente â†’ Vista detallada
â”‚   â”œâ”€ PestaÃ±a "InformaciÃ³n": Datos + Editar
â”‚   â””â”€ PestaÃ±a "Cuenta Corriente": Movimientos + Registrar pago
â”œâ”€ Exportar listado Excel
â””â”€ Eliminar (si no tiene pedidos asociados)</code></pre>
        </section>

        <!-- SECCIÃ“N 3: INTERFAZ DE USUARIO -->
        <section id="interfaz">
            <h2>3. Interfaz de Usuario</h2>

            <h3>3.1 Layout general</h3>
            <p><strong>Vista principal:</strong> Tabla de clientes con filtros superiores y botÃ³n [+ Crear cliente]</p>

            <p><strong>Estructura:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLIENTES                                     [+ Crear]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Filtros:  [Ciudad â–¼]  [Descuento â–¼]  [Saldo â–¼]  [BÃºsqueda] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DirecciÃ³n              â”‚ TelÃ©fono    â”‚ Ciudad  â”‚ Saldo      â”‚
â”‚  Calle Falsa 123        â”‚ 299-1234567 â”‚ NeuquÃ©n â”‚ -$50.000 ğŸ”´â”‚
â”‚  Av. Argentina 456      â”‚ 299-7654321 â”‚ Plottierâ”‚  $0      âœ“ â”‚
â”‚  Ruta 22 Km 5           â”‚ 298-1112233 â”‚ Centenarâ”‚ +$12.300 ğŸŸ¢â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        ğŸ”´ = Debe | ğŸŸ¢ = A favor</code></pre>

            <h3>3.2 Filtros y bÃºsqueda</h3>
            <table>
                <thead>
                    <tr>
                        <th>Filtro</th>
                        <th>Tipo</th>
                        <th>Opciones</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Ciudad</strong></td>
                        <td>Dropdown</td>
                        <td>Todas / NeuquÃ©n / Plottier / Centenario / Otras</td>
                        <td>Filtra clientes por ciudad</td>
                    </tr>
                    <tr>
                        <td><strong>Descuento</strong></td>
                        <td>Dropdown</td>
                        <td>Todos / Sin descuento / L2 (6.25%) / L3 (10%)</td>
                        <td>Filtra por descuento fijo configurado</td>
                    </tr>
                    <tr>
                        <td><strong>Saldo</strong></td>
                        <td>Dropdown</td>
                        <td>Todos / Debe (negativo) / A favor (positivo) / $0</td>
                        <td>Filtra por estado de cuenta corriente</td>
                    </tr>
                    <tr>
                        <td><strong>BÃºsqueda</strong></td>
                        <td>Input text</td>
                        <td>Busca en direcciÃ³n, telÃ©fono, ciudad</td>
                        <td>Filtrado en tiempo real</td>
                    </tr>
                </tbody>
            </table>

            <h3>3.3 Tabla principal</h3>
            <p><strong>Columnas visibles:</strong></p>
            <ul>
                <li><strong>DirecciÃ³n</strong>: Identificador principal (clickeable â†’ abre detalle)</li>
                <li><strong>TelÃ©fono</strong>: NÃºmero de contacto</li>
                <li><strong>Ciudad</strong>: Ciudad del cliente</li>
                <li><strong>Saldo CC</strong>: Saldo cuenta corriente con indicador visual:
                    <ul>
                        <li>ğŸ”´ Rojo: Saldo negativo (debe)</li>
                        <li>ğŸŸ¢ Verde: Saldo positivo (a favor)</li>
                        <li>âœ“ Neutro: Saldo $0</li>
                    </ul>
                </li>
                <li><strong>Acciones</strong>: Botones Ver detalle | Editar | Eliminar</li>
            </ul>

            <p><strong>Ordenamiento:</strong></p>
            <ul>
                <li>Default: Por direcciÃ³n (A-Z)</li>
                <li>Clickeable en headers: Permite ordenar por cualquier columna</li>
            </ul>

            <h3>3.4 Modal: Crear/Editar Cliente</h3>
            <p><strong>Campos del formulario:</strong></p>

            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>Tipo</th>
                        <th>Obligatorio</th>
                        <th>DescripciÃ³n</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Nombre</strong></td>
                        <td>Text</td>
                        <td>âŒ No</td>
                        <td>Nombre del cliente (opcional)</td>
                    </tr>
                    <tr>
                        <td><strong>DirecciÃ³n</strong></td>
                        <td>Text</td>
                        <td>âœ… SÃ­</td>
                        <td>Identificador principal (Ãºnico)</td>
                    </tr>
                    <tr>
                        <td><strong>TelÃ©fono</strong></td>
                        <td>Text</td>
                        <td>âœ… SÃ­</td>
                        <td>NÃºmero de contacto</td>
                    </tr>
                    <tr>
                        <td><strong>Email</strong></td>
                        <td>Email</td>
                        <td>âŒ No</td>
                        <td>Email del cliente (opcional)</td>
                    </tr>
                    <tr>
                        <td><strong>Ciudad</strong></td>
                        <td>Dropdown</td>
                        <td>âœ… SÃ­</td>
                        <td>NeuquÃ©n / Plottier / Centenario / Otras</td>
                    </tr>
                    <tr>
                        <td><strong>Descuento fijo</strong></td>
                        <td>Radio buttons</td>
                        <td>-</td>
                        <td>Sin descuento (default) / L2 (6.25%) / L3 (10%)</td>
                    </tr>
                    <tr>
                        <td><strong>Nota</strong></td>
                        <td>Textarea</td>
                        <td>âŒ No</td>
                        <td>Nota interna sobre el cliente (opcional)</td>
                    </tr>
                    <tr>
                        <td><strong>Activo</strong></td>
                        <td>Checkbox (header modal)</td>
                        <td>-</td>
                        <td>Toggle para marcar cliente activo/inactivo</td>
                    </tr>
                </tbody>
            </table>

            <div class="note" style="background: #e7f3ff; border-left: 4px solid #2196F3; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0.5rem 0;"><strong>â­ Descuento fijo por cliente (NUEVO):</strong> En lugar de campo de texto personalizado, se usan <strong>radio buttons</strong> para seleccionar descuento estÃ¡ndar (L2/L3). Esto simplifica la gestiÃ³n al usar solo las listas de precios estÃ¡ndar en lugar de porcentajes custom.</p>
            </div>

            <p><strong>Ejemplo visual del formulario - SecciÃ³n descuento:</strong></p>
            <pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Descuento fijo del cliente        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â— Sin descuento                   â”‚
â”‚  â—‹ L2 (6.25%)                      â”‚
â”‚  â—‹ L3 (10.00%)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜</code></pre>

            <h3>3.5 Vista detallada del cliente</h3>
            <p><strong>Acceso:</strong> Click en direcciÃ³n del cliente en la tabla principal</p>

            <p><strong>Header:</strong> DirecciÃ³n + badges (estado, descuento) + botones editar/eliminar</p>

            <p><strong>Estructura con 3 pestaÃ±as:</strong> (Cuenta Corriente es la tab por defecto)</p>

            <h4>3.5.1 PestaÃ±a "Cuenta Corriente" (default)</h4>
            <p><strong>Contenido:</strong> Vista completa de la cuenta corriente del cliente</p>
            <p><strong>ğŸ“„ EspecificaciÃ³n detallada:</strong> <a href="cuenta-corriente.html" target="_blank">Ver PRD Cuenta Corriente completo</a></p>

            <h4>3.5.2 PestaÃ±a "Historial Pedidos"</h4>
            <p><strong>Contenido:</strong></p>
            <ul>
                <li>Tabla con todos los pedidos del cliente</li>
                <li>Columnas: Fecha | Pedido # | Estado | Total | MÃ©todo pago</li>
                <li>Clickeable â†’ Abre detalle del pedido en mÃ³dulo Ventas</li>
                <li>Ordenamiento: CronolÃ³gico descendente (mÃ¡s recientes primero)</li>
            </ul>

            <h4>3.5.3 PestaÃ±a "InformaciÃ³n"</h4>
            <p><strong>Panel muestra:</strong></p>
            <ul>
                <li>Datos de contacto: TelÃ©fono, Email, Ciudad</li>
                <li>Nota interna (si existe)</li>
                <li>Fecha de creaciÃ³n</li>
            </ul>

            <p><strong>Panel superior de Cuenta Corriente muestra:</strong></p>
            <ul>
                <li><strong>Saldo actual:</strong> Indicador visual (rojo si debe, verde si a favor)</li>
                <li>Total de pedidos realizados</li>
                <li>Fecha de Ãºltima compra</li>
                <li>Botones: [+ Registrar pago genÃ©rico] [Exportar Excel]</li>
            </ul>

            <p><strong>Tabla de movimientos:</strong></p>
            <ul>
                <li>Fecha | Tipo (Cargo/Pago) | DescripciÃ³n | Cargo | Pago | MÃ©todo | Saldo</li>
                <li>Ordenamiento cronolÃ³gico descendente</li>
                <li>Detalle expandible por movimiento</li>
            </ul>

            <h3>3.6 Barra de acciones rÃ¡pidas</h3>
            <p><strong>UbicaciÃ³n:</strong> Columna "Acciones" a la derecha de cada fila</p>

            <p><strong>Botones disponibles:</strong></p>
            <ul>
                <li><strong>[Ver detalle]</strong>: Abre vista detallada del cliente</li>
                <li><strong>[Editar]</strong>: Abre modal Editar Cliente</li>
                <li><strong>[Eliminar]</strong>: ConfirmaciÃ³n â†’ Elimina cliente (si no tiene pedidos asociados)</li>
            </ul>

            <div class="note" style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
                <p style="margin: 0;"><strong>âš ï¸ RestricciÃ³n de eliminaciÃ³n:</strong> No se puede eliminar un cliente que tenga pedidos asociados (activos o histÃ³ricos). La cuenta corriente siempre debe tener trazabilidad completa.</p>
            </div>

            <h3>3.7 Exportar listado de clientes</h3>
            <p><strong>UbicaciÃ³n:</strong> BotÃ³n [Exportar Excel] en header superior</p>

            <p><strong>Archivo generado:</strong></p>
            <ul>
                <li>Nombre: <code>clientes_bambu_YYYY-MM-DD.xlsx</code></li>
                <li>Columnas: DirecciÃ³n | TelÃ©fono | Email | Ciudad | Descuento | Saldo CC</li>
                <li>Ordenado por ciudad y direcciÃ³n</li>
                <li>Filtros aplicados en la tabla se respetan en la exportaciÃ³n</li>
            </ul>

            <p><strong>Uso:</strong> Reporte para control administrativo, envÃ­o a contador, o anÃ¡lisis comercial</p>
        </section>

        <!-- SECCIÃ“N 4: REGLAS DE NEGOCIO -->
        <section id="reglas">
            <h2>4. Reglas de Negocio EspecÃ­ficas</h2>

            <h3>4.1 Validaciones</h3>
            <table>
                <thead>
                    <tr>
                        <th>Campo</th>
                        <th>ValidaciÃ³n</th>
                        <th>Mensaje de error</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>DirecciÃ³n</strong></td>
                        <td>Ãšnico (no puede haber 2 clientes con misma direcciÃ³n)</td>
                        <td>"Ya existe un cliente con esta direcciÃ³n"</td>
                    </tr>
                    <tr>
                        <td><strong>TelÃ©fono</strong></td>
                        <td>Formato numÃ©rico (sin validaciÃ³n estricta)</td>
                        <td>-</td>
                    </tr>
                    <tr>
                        <td><strong>Email</strong></td>
                        <td>Formato email vÃ¡lido (si se completa)</td>
                        <td>"Email invÃ¡lido"</td>
                    </tr>
                    <tr>
                        <td><strong>Ciudad</strong></td>
                        <td>Debe ser una ciudad existente en el sistema</td>
                        <td>"Seleccione una ciudad vÃ¡lida"</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.2 Descuento fijo por cliente</h3>
            <p><strong>Comportamiento:</strong></p>
            <ul>
                <li>Si tiene descuento L2 o L3, <strong>reemplaza</strong> el descuento de lista en todas sus compras</li>
                <li>Pensado para empleados, VIPs, revendedores frecuentes</li>
                <li>No se combina con el descuento de lista seleccionado en cotizador, lo sustituye</li>
                <li>Al seleccionar el cliente en el cotizador, se aplica automÃ¡ticamente su descuento fijo (L2 o L3)</li>
            </ul>

            <p><strong>Ventaja:</strong> Simplifica la gestiÃ³n al usar solo las listas de precios estÃ¡ndar (L2 y L3) en lugar de porcentajes custom</p>

            <p><strong>Ejemplo:</strong></p>
            <table>
                <thead>
                    <tr>
                        <th>Producto</th>
                        <th>Precio L1</th>
                        <th>Cliente sin descuento</th>
                        <th>Cliente con L2</th>
                        <th>Cliente con L3</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Detergente</td>
                        <td>$4.500</td>
                        <td>$4.500</td>
                        <td>$4.218 (L2 -6.25%)</td>
                        <td>$4.050 (L3 -10%)</td>
                    </tr>
                </tbody>
            </table>

            <h3>4.3 Cuenta corriente automÃ¡tica</h3>
            <p><strong>Regla:</strong> Todos los clientes tienen cuenta corriente (obligatorio)</p>

            <p><strong>CaracterÃ­sticas:</strong></p>
            <ul>
                <li>Cargos automÃ¡ticos al confirmar pedidos</li>
                <li>Pagos manuales (totales, parciales, genÃ©ricos)</li>
                <li>DiscriminaciÃ³n efectivo/digital/mixto</li>
                <li>Historial cronolÃ³gico completo</li>
                <li>Saldo actualizado en tiempo real</li>
            </ul>

            <p><strong>No hay lÃ­mite de crÃ©dito:</strong> El sistema no bloquea ventas por deuda. El control es manual por parte del administrador.</p>

            <h3>4.4 IdentificaciÃ³n por direcciÃ³n</h3>
            <p><strong>RazÃ³n:</strong> En el negocio de QuÃ­mica Bambu, los clientes se identifican naturalmente por su direcciÃ³n (punto de entrega), no por CUIT o razÃ³n social.</p>

            <p><strong>Implicaciones:</strong></p>
            <ul>
                <li>La direcciÃ³n es Ãºnica y obligatoria</li>
                <li>El buscador del cotizador busca por direcciÃ³n</li>
                <li>Los reportes muestran direcciÃ³n como identificador principal</li>
                <li>En repartos, los pedidos se ordenan por direcciÃ³n/ciudad</li>
            </ul>

            <h3>4.5 Restricciones de eliminaciÃ³n</h3>
            <p><strong>No se puede eliminar un cliente si:</strong></p>
            <ul>
                <li>Tiene pedidos asociados (activos o histÃ³ricos)</li>
                <li>Tiene movimientos en cuenta corriente</li>
                <li>Tiene saldo diferente de $0</li>
            </ul>

            <p><strong>Mensaje:</strong> "No se puede eliminar este cliente porque tiene pedidos o movimientos asociados"</p>

            <p><strong>Alternativa:</strong> Marcar como "inactivo" (funcionalidad futura) en lugar de eliminar</p>
        </section>

        <!-- SECCIÃ“N 5: INTEGRACIÃ“N -->
        <section id="integracion">
            <h2>5. IntegraciÃ³n con Otros MÃ³dulos</h2>

            <h3>5.1 Cotizador</h3>
            <p><strong>RelaciÃ³n:</strong> El cotizador selecciona clientes para asignar pedidos</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Buscador de clientes consume la tabla de clientes</li>
                <li>Al seleccionar cliente, se carga automÃ¡ticamente:
                    <ul>
                        <li>DirecciÃ³n de entrega</li>
                        <li>Ciudad (define disponibilidad de reparto)</li>
                        <li>Descuento fijo (si tiene L2/L3 configurado)</li>
                        <li>Saldo actual de cuenta corriente (visible para operador)</li>
                    </ul>
                </li>
                <li>Al confirmar pedido â†’ Cargo automÃ¡tico en cuenta corriente del cliente</li>
            </ul>

            <h3>5.2 Cuenta Corriente</h3>
            <p><strong>RelaciÃ³n:</strong> Cuenta Corriente es una vista integrada dentro de Cliente + MÃ³dulo independiente</p>

            <p><strong>SincronizaciÃ³n bidireccional:</strong></p>
            <ul>
                <li>Desde Cliente â†’ PestaÃ±a "Cuenta Corriente" muestra movimientos del cliente</li>
                <li>Desde mÃ³dulo CC independiente â†’ Selecciona cliente y muestra mismos datos</li>
                <li>Pagos registrados en cualquiera de los dos lados se sincronizan</li>
                <li>Saldo mostrado en tabla de Clientes proviene de CC</li>
            </ul>

            <p><strong>ğŸ“„ EspecificaciÃ³n detallada:</strong> <a href="cuenta-corriente.html" target="_blank">Ver PRD Cuenta Corriente completo</a></p>

            <h3>5.3 Ventas</h3>
            <p><strong>RelaciÃ³n:</strong> Ventas muestra pedidos asociados a clientes</p>

            <p><strong>SincronizaciÃ³n:</strong></p>
            <ul>
                <li>Desde Clientes â†’ Historial de pedidos clickeable abre pedido en Ventas</li>
                <li>Desde Ventas â†’ Click en cliente abre detalle de Cliente</li>
                <li>Filtro por cliente en Ventas consume tabla de clientes</li>
                <li>Pagos registrados en Ventas actualizan cuenta corriente del cliente</li>
            </ul>

            <h3>5.4 ConfiguraciÃ³n</h3>
            <p><strong>RelaciÃ³n:</strong> ConfiguraciÃ³n define parÃ¡metros que afectan a clientes</p>

            <p><strong>Dependencias:</strong></p>
            <ul>
                <li><strong>Listas de precio:</strong> ConfiguraciÃ³n define % de descuento L2 (6.25%) y L3 (10%)</li>
                <li><strong>Ciudades:</strong> Dropdown de ciudades se alimenta desde ConfiguraciÃ³n</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 6: CASOS DE USO -->
        <section id="casos-uso">
            <h2>6. Casos de Uso</h2>

            <h3>Caso 1: Crear cliente nuevo</h3>
            <p><strong>Contexto:</strong> Administrador necesita agregar un cliente nuevo</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario abre mÃ³dulo Clientes</li>
                <li>Click en [+ Crear cliente]</li>
                <li>Completa formulario:
                    <ul>
                        <li>DirecciÃ³n: "Calle Falsa 123"</li>
                        <li>TelÃ©fono: "299-1234567"</li>
                        <li>Email: "cliente@ejemplo.com"</li>
                        <li>Ciudad: "NeuquÃ©n"</li>
                        <li>Descuento fijo: â—‹ Sin descuento</li>
                    </ul>
                </li>
                <li>Click [Guardar]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Cliente creado correctamente</li>
                <li>âœ… Aparece en tabla de clientes</li>
                <li>âœ… Cuenta corriente creada automÃ¡ticamente con saldo $0</li>
                <li>âœ… Ya disponible en buscador del cotizador</li>
            </ul>

            <h3>Caso 2: Configurar descuento fijo para cliente VIP</h3>
            <p><strong>Contexto:</strong> Cliente frecuente merece descuento permanente</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario busca cliente "Av. Argentina 456"</li>
                <li>Click en [Editar]</li>
                <li>Cambia radio button de "Sin descuento" a "â—‹ L2 (6.25%)"</li>
                <li>Click [Guardar]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Cliente configurado con descuento L2</li>
                <li>âœ… Badge "L2" visible en tabla de clientes</li>
                <li>âœ… Al crear pedidos en cotizador, se aplica automÃ¡ticamente L2</li>
                <li>âœ… Todos los productos (excepto promocionales) se cobran con 6.25% descuento</li>
            </ul>

            <h3>Caso 3: Consultar cuenta corriente de un cliente</h3>
            <p><strong>Contexto:</strong> Operador necesita verificar saldo antes de autorizar pedido</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario busca cliente "Ruta 22 Km 5" en tabla</li>
                <li>Click en direcciÃ³n â†’ Vista detallada</li>
                <li>Click en pestaÃ±a "Cuenta Corriente"</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Ve saldo actual: -$50.000 (debe)</li>
                <li>âœ… Ve historial completo de movimientos (cargos y pagos)</li>
                <li>âœ… Ve Ãºltima compra: 28/12/2024</li>
                <li>âœ… Puede registrar pago genÃ©rico si cliente pagÃ³</li>
                <li>âœ… Puede exportar Excel de movimientos</li>
            </ul>

            <h3>Caso 4: Filtrar clientes con saldo a favor</h3>
            <p><strong>Contexto:</strong> Administrador quiere ver clientes que pagaron adelantos</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario abre mÃ³dulo Clientes</li>
                <li>Aplica filtro: Saldo â†’ "A favor (positivo)"</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Tabla muestra solo clientes con saldo positivo</li>
                <li>âœ… Indicador ğŸŸ¢ verde en columna Saldo</li>
                <li>âœ… Puede exportar Excel de esta selecciÃ³n</li>
            </ul>

            <h3>Caso 5: Ver historial de pedidos de un cliente</h3>
            <p><strong>Contexto:</strong> Vendedor quiere revisar quÃ© compra habitualmente un cliente</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario busca cliente en tabla</li>
                <li>Click en direcciÃ³n â†’ Vista detallada</li>
                <li>PestaÃ±a "InformaciÃ³n" muestra historial de pedidos</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Tabla con Ãºltimos pedidos del cliente (fecha, #, estado, total)</li>
                <li>âœ… Puede ver productos frecuentes</li>
                <li>âœ… Click en pedido â†’ Abre detalle en mÃ³dulo Ventas</li>
            </ul>

            <h3>Caso 6: Exportar listado de clientes por ciudad</h3>
            <p><strong>Contexto:</strong> Administrador necesita reporte de clientes de Plottier</p>
            <p><strong>AcciÃ³n:</strong></p>
            <ol>
                <li>Usuario abre mÃ³dulo Clientes</li>
                <li>Aplica filtro: Ciudad â†’ "Plottier"</li>
                <li>Click en [Exportar Excel]</li>
            </ol>
            <p><strong>Resultado:</strong></p>
            <ul>
                <li>âœ… Descarga archivo <code>clientes_bambu_2024-12-31.xlsx</code></li>
                <li>âœ… Contiene solo clientes de Plottier</li>
                <li>âœ… Columnas: DirecciÃ³n | TelÃ©fono | Email | Ciudad | Descuento | Saldo CC</li>
            </ul>
        </section>

        <!-- SECCIÃ“N 7: FLUJOS DE USUARIO -->
        <section id="flujos">
            <h2>7. Flujos de Usuario</h2>

            <h3>7.1 Flujo principal: GestiÃ³n de cliente</h3>
            <pre><code>Usuario accede a mÃ³dulo Clientes
        â†“
Vista tabla completa de clientes
        â†“
Aplica filtros (opcional)
â”œâ”€ Por ciudad
â”œâ”€ Por descuento
â”œâ”€ Por saldo
â””â”€ BÃºsqueda por direcciÃ³n/telÃ©fono
        â†“
Selecciona acciÃ³n:
â”œâ”€ [+ Crear cliente] â†’ Modal crear â†’ Guardar â†’ Cliente agregado
â”œâ”€ Click en direcciÃ³n â†’ Vista detallada
â”‚   â”œâ”€ PestaÃ±a "InformaciÃ³n" â†’ Ver datos + Historial pedidos
â”‚   â””â”€ PestaÃ±a "Cuenta Corriente" â†’ Ver movimientos + Registrar pago
â”œâ”€ [Editar] â†’ Modal editar â†’ Guardar â†’ Cliente actualizado
â”œâ”€ [Eliminar] â†’ ConfirmaciÃ³n â†’ Cliente eliminado (si no tiene pedidos)
â””â”€ [Exportar Excel] â†’ Descargar listado filtrado</code></pre>

            <h3>7.2 Flujo: Configurar descuento fijo</h3>
            <pre><code>Administrador identifica cliente VIP
        â†“
Busca cliente en tabla
        â†“
Click [Editar]
        â†“
Modal muestra formulario con radio buttons:
â”œâ”€ â— Sin descuento (default)
â”œâ”€ â—‹ L2 (6.25%)
â””â”€ â—‹ L3 (10.00%)
        â†“
Selecciona L2 o L3
        â†“
Click [Guardar]
        â†“
Sistema actualiza:
- Badge en tabla de clientes
- Descuento aplicado automÃ¡ticamente en cotizador
- Todos los pedidos futuros usan ese descuento
        â†“
NotificaciÃ³n: âœ… "Cliente actualizado correctamente"</code></pre>

            <h3>7.3 Flujo: Consultar cuenta corriente</h3>
            <pre><code>Usuario busca cliente en tabla
        â†“
Click en direcciÃ³n â†’ Vista detallada
        â†“
Click en pestaÃ±a "Cuenta Corriente"
        â†“
Sistema muestra:
â”œâ”€ Panel superior:
â”‚   â”œâ”€ Saldo actual (con color: rojo/verde)
â”‚   â”œâ”€ Total pedidos realizados
â”‚   â”œâ”€ Fecha Ãºltima compra
â”‚   â””â”€ Botones: [+ Pago genÃ©rico] [Exportar Excel]
â””â”€ Tabla de movimientos cronolÃ³gicos:
    â”œâ”€ Fecha | Tipo | DescripciÃ³n
    â”œâ”€ Cargo | Pago | MÃ©todo | Saldo
    â””â”€ Expandible para ver detalles
        â†“
Usuario puede:
â”œâ”€ Registrar pago genÃ©rico
â”œâ”€ Exportar Excel de movimientos
â””â”€ Ver historial completo</code></pre>

            <h3>7.4 Flujo: Seleccionar cliente en cotizador</h3>
            <pre><code>Usuario crea pedido en Cotizador
        â†“
Click en campo "Cliente"
        â†“
Buscador muestra lista de clientes:
- BÃºsqueda por direcciÃ³n/telÃ©fono
- Ordenados alfabÃ©ticamente
        â†“
Usuario selecciona cliente
        â†“
Sistema carga automÃ¡ticamente:
â”œâ”€ DirecciÃ³n de entrega
â”œâ”€ Ciudad (define disponibilidad reparto)
â”œâ”€ Descuento fijo (si tiene L2/L3)
â””â”€ Saldo actual CC (visible para operador)
        â†“
Usuario continÃºa agregando productos
        â†“
Al confirmar pedido:
- Se genera cargo en cuenta corriente del cliente
- Saldo se actualiza automÃ¡ticamente</code></pre>
        </section>

        <!-- SECCIÃ“N 8: NOTAS TÃ‰CNICAS -->
        <section id="notas-tecnicas">
            <h2>8. Notas TÃ©cnicas para Desarrollo</h2>

            <h3>8.1 Estructura de datos (Mock data)</h3>
            <pre><code class="language-javascript">// Ejemplo de estructura para prototipos
const CLIENTE_EJEMPLO = {
    id: 1,
    nombre: null, // Opcional
    direccion: "Calle Falsa 123", // Identificador principal (Ãºnico)
    telefono: "299-1234567",
    email: "cliente@ejemplo.com", // Opcional
    ciudad: "NeuquÃ©n",
    descuento_fijo: null, // null = sin descuento | "L2" | "L3"
    saldo_cc: -50000, // Saldo cuenta corriente (negativo = debe)
    total_pedidos: 15, // Cantidad de pedidos realizados
    fecha_ultima_compra: "2024-12-28",
    created_at: "2024-01-10",
    updated_at: "2024-12-30"
};

// Ejemplo cliente con descuento L2
const CLIENTE_VIP = {
    id: 5,
    nombre: "Juan PÃ©rez", // Opcional
    direccion: "Av. Argentina 456",
    telefono: "299-7654321",
    email: null,
    ciudad: "Plottier",
    descuento_fijo: "L2", // Descuento permanente 6.25%
    saldo_cc: 0, // Saldo $0
    total_pedidos: 42,
    fecha_ultima_compra: "2024-12-29",
    created_at: "2023-05-20",
    updated_at: "2024-12-29"
};

// Ejemplo cliente con saldo a favor
const CLIENTE_ADELANTO = {
    id: 8,
    nombre: null,
    direccion: "Ruta 22 Km 5",
    telefono: "298-1112233",
    email: "contacto@empresa.com",
    ciudad: "Centenario",
    descuento_fijo: "L3", // Descuento permanente 10%
    saldo_cc: 12300, // Saldo positivo (a favor)
    total_pedidos: 8,
    fecha_ultima_compra: "2024-12-20",
    created_at: "2024-08-15",
    updated_at: "2024-12-27"
};
</code></pre>

            <h3>8.2 Consideraciones de implementaciÃ³n</h3>
            <ul>
                <li>âš ï¸ <strong>DirecciÃ³n Ãºnica:</strong> Implementar validaciÃ³n en tiempo real (al escribir) para evitar duplicados</li>
                <li>âš ï¸ <strong>Saldo CC:</strong> Calculado en tiempo real desde tabla movimientos_cc (no almacenar redundante)</li>
                <li>âš ï¸ <strong>Descuento fijo:</strong> Al seleccionar cliente en cotizador, aplicar descuento automÃ¡ticamente</li>
                <li>âš ï¸ <strong>RestricciÃ³n de eliminaciÃ³n:</strong> Query pre-eliminaciÃ³n: <code>SELECT COUNT(*) FROM pedidos WHERE cliente_id = ?</code></li>
                <li>ğŸ’¡ <strong>BÃºsqueda eficiente:</strong> Ãndice en columna direcciÃ³n para bÃºsquedas rÃ¡pidas</li>
                <li>ğŸ’¡ <strong>Indicador visual de saldo:</strong> Usar clases CSS condicionales (rojo/verde) segÃºn signo del saldo</li>
                <li>ğŸ’¡ <strong>ExportaciÃ³n Excel:</strong> Respetar filtros activos en la tabla al exportar</li>
            </ul>

            <h3>8.3 Queries SQL Ãºtiles</h3>
            <pre><code class="language-sql">-- Obtener clientes con saldo negativo (deben)
SELECT c.*, cc.saldo
FROM clientes c
LEFT JOIN (
    SELECT cliente_id, SUM(monto) as saldo
    FROM movimientos_cuenta_corriente
    GROUP BY cliente_id
) cc ON c.id = cc.cliente_id
WHERE cc.saldo < 0
ORDER BY cc.saldo ASC;

-- Obtener clientes con descuento L2 o L3
SELECT * FROM clientes
WHERE descuento_fijo IN ('L2', 'L3')
ORDER BY direccion ASC;

-- Obtener clientes de una ciudad especÃ­fica
SELECT * FROM clientes
WHERE ciudad = ?
ORDER BY direccion ASC;

-- Verificar si cliente tiene pedidos (para permitir eliminaciÃ³n)
SELECT COUNT(*) as total_pedidos
FROM pedidos
WHERE cliente_id = ?;</code></pre>

            <h3>8.4 Estructura de base de datos sugerida</h3>
            <pre><code class="language-sql">CREATE TABLE clientes (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(255), -- Opcional
    direccion VARCHAR(255) UNIQUE NOT NULL, -- Identificador principal
    telefono VARCHAR(50) NOT NULL,
    email VARCHAR(255), -- Opcional
    ciudad VARCHAR(100) NOT NULL,
    descuento_fijo VARCHAR(3) CHECK (descuento_fijo IN ('L2', 'L3')), -- null = sin descuento
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Ãndice para bÃºsquedas rÃ¡pidas
CREATE INDEX idx_clientes_direccion ON clientes(direccion);
CREATE INDEX idx_clientes_ciudad ON clientes(ciudad);

-- Trigger para actualizar updated_at
CREATE TRIGGER update_clientes_updated_at
    BEFORE UPDATE ON clientes
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();</code></pre>

            <h3>8.5 CÃ¡lculo de saldo de cuenta corriente</h3>
            <pre><code class="language-sql">-- FunciÃ³n para calcular saldo actual de un cliente
CREATE OR REPLACE FUNCTION calcular_saldo_cliente(p_cliente_id INT)
RETURNS DECIMAL(10,2) AS $$
DECLARE
    v_saldo DECIMAL(10,2);
BEGIN
    SELECT COALESCE(SUM(
        CASE
            WHEN tipo = 'CARGO' THEN -monto  -- Cargos son negativos (debe)
            WHEN tipo = 'PAGO' THEN monto     -- Pagos son positivos (a favor)
        END
    ), 0)
    INTO v_saldo
    FROM movimientos_cuenta_corriente
    WHERE cliente_id = p_cliente_id;

    RETURN v_saldo;
END;
$$ LANGUAGE plpgsql;

-- Uso:
SELECT direccion, calcular_saldo_cliente(id) as saldo
FROM clientes
WHERE id = ?;</code></pre>
        </section>

        <!-- PIE DE PÃGINA -->
        <footer>
            <p>Bambu CRM V2 - PRD TÃ©cnico | Ãšltima actualizaciÃ³n: 31 Diciembre 2024</p>
            <p><a href="index.html">â† Volver al PRD General</a></p>
        </footer>
    </main>

    <!-- SCRIPT PARA TOC AUTO -->
    <script>
        // Auto-generar tabla de contenidos desde los h2
        const toc = document.getElementById('toc');
        const h2s = document.querySelectorAll('main h2');
        h2s.forEach(h2 => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = '#' + h2.parentElement.id;
            a.textContent = h2.textContent;
            a.className = 'nav-link';
            li.appendChild(a);
            toc.appendChild(li);
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-toggle')?.addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });
    </script>
</body>

</html>
